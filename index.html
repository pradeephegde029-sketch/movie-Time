<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1.0">
<title>Reel to Deal â€” Book Tickets</title>
<link rel="preconnect" href="https://fonts.googleapis.com">
<link href="https://fonts.googleapis.com/css2?family=Playfair+Display:ital,wght@0,400;0,700;0,900;1,400;1,700&family=JetBrains+Mono:wght@300;400;500;700&family=Outfit:wght@300;400;500;600&display=swap" rel="stylesheet">
<script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
<style>
/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   DESIGN TOKENS
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
:root {
  --bg:       #06050a;
  --bg2:      #0c0b12;
  --sur:      #12101a;
  --sur2:     #181524;
  --sur3:     #201d2e;
  --sur4:     #2a263c;
  --border:   rgba(255,255,255,0.07);
  --border2:  rgba(255,255,255,0.12);

  --gold:     #d4a843;
  --gold2:    #f0c760;
  --gold3:    #fbe49a;
  --goldglow: rgba(212,168,67,0.18);
  --goldrim:  rgba(212,168,67,0.35);

  --text:     #ede8d8;
  --muted:    #8a7e6a;
  --faint:    #3d3830;

  --green:    #3dd68c;
  --greendim: rgba(61,214,140,0.14);
  --red:      #f05252;
  --reddim:   rgba(240,82,82,0.14);
  --yellow:   #fbbf24;
  --yellowdim:rgba(251,191,36,0.14);
  --blue:     #60a5fa;
  --bluedim:  rgba(96,165,250,0.14);
  --purple:   #a78bfa;
  --purpledim:rgba(167,139,250,0.14);

  --r6: 6px; --r10: 10px; --r14: 14px; --r20: 20px; --r28: 28px;
  --ease: cubic-bezier(0.16,1,0.3,1);
}

*, *::before, *::after { margin:0; padding:0; box-sizing:border-box; }
html { scroll-behavior:smooth; -webkit-tap-highlight-color: transparent; }

body {
  background: var(--bg);
  color: var(--text);
  font-family: 'Outfit', sans-serif;
  min-height: 100vh;
  overflow-x: hidden;
}

/* Ambient background orbs */
.orb {
  position: fixed; border-radius: 50%; filter: blur(80px);
  pointer-events: none; z-index: 0;
}
.orb-1 { width:500px; height:500px; background:rgba(212,168,67,0.05); top:-100px; left:50%; transform:translateX(-50%); }
.orb-2 { width:300px; height:300px; background:rgba(96,165,250,0.04); bottom:10%; right:-80px; }
.orb-3 { width:250px; height:250px; background:rgba(167,139,250,0.04); top:40%; left:-60px; }

/* Film grain overlay */
body::after {
  content:''; position:fixed; inset:0; z-index:0; opacity:0.018; pointer-events:none;
  background-image: url("data:image/svg+xml,%3Csvg viewBox='0 0 200 200' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='n'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.85' numOctaves='4' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23n)'/%3E%3C/svg%3E");
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   SPLASH
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
#splash {
  position:fixed; inset:0; z-index:9999;
  background:var(--bg);
  display:flex; flex-direction:column; align-items:center; justify-content:center; gap:20px;
  transition: opacity 0.9s var(--ease), visibility 0.9s;
}
#splash.gone { opacity:0; visibility:hidden; pointer-events:none; }
.sp-icon { font-size:3rem; animation: reelSpin 1.2s ease-in-out infinite; }
@keyframes reelSpin { 0%,100%{transform:rotate(0)} 50%{transform:rotate(180deg)} }
.sp-logo {
  font-family:'Playfair Display',serif; font-weight:900;
  font-size:clamp(2rem,8vw,3.8rem);
  background:linear-gradient(135deg,var(--gold3),var(--gold2),var(--gold));
  -webkit-background-clip:text; -webkit-text-fill-color:transparent; background-clip:text;
}
.sp-logo em { font-style:italic; }
.sp-sub { font-family:'JetBrains Mono',monospace; font-size:0.62rem; letter-spacing:0.3em; color:var(--muted); text-transform:uppercase; }
.sp-track { width:180px; height:2px; background:var(--sur3); border-radius:2px; overflow:hidden; }
.sp-fill  { height:100%; background:linear-gradient(90deg,var(--gold),var(--gold2)); animation:splashFill 1.6s var(--ease) forwards; }
@keyframes splashFill { from{width:0} to{width:100%} }

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   TOPBAR
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
#topbar {
  position:sticky; top:0; z-index:200;
  display:flex; align-items:center; justify-content:space-between;
  padding:13px 18px;
  background:rgba(6,5,10,0.88); backdrop-filter:blur(24px);
  border-bottom:1px solid var(--border);
}
.tb-brand { font-family:'Playfair Display',serif; font-size:1.1rem; font-weight:700; color:var(--gold2); }
.tb-brand em { font-style:italic; color:var(--gold3); }
.tb-right { display:flex; align-items:center; gap:8px; }

.nav-pill {
  background:none; border:none; cursor:pointer;
  font-family:'JetBrains Mono',monospace; font-size:0.65rem; letter-spacing:0.08em;
  text-transform:uppercase; color:var(--muted);
  padding:6px 11px; border-radius:100px;
  transition:all 0.2s;
}
.nav-pill.active { background:var(--goldglow); color:var(--gold2); border:1px solid var(--goldrim); }
.nav-pill:hover:not(.active) { color:var(--gold2); }

.sync-chip {
  display:flex; align-items:center; gap:5px;
  font-family:'JetBrains Mono',monospace; font-size:0.58rem; letter-spacing:0.08em;
  color:var(--muted); padding:4px 8px; border-radius:100px;
  border:1px solid var(--border);
}
.sync-dot { width:6px; height:6px; border-radius:50%; background:var(--green); }
.sync-dot.off { background:var(--red); box-shadow:none !important; }
.sync-dot:not(.off) { animation:syncPulse 2.5s infinite; box-shadow:0 0 0 0 rgba(61,214,140,0.4); }
@keyframes syncPulse { 0%,100%{box-shadow:0 0 0 0 rgba(61,214,140,0.4)} 50%{box-shadow:0 0 0 5px rgba(61,214,140,0)} }

.bell-btn {
  position:relative; background:none; border:none; cursor:pointer;
  font-size:1.15rem; color:var(--muted); padding:5px;
  transition:color 0.2s;
}
.bell-btn:hover { color:var(--gold2); }
.bell-badge {
  position:absolute; top:1px; right:1px;
  background:var(--red); color:#fff;
  font-family:'JetBrains Mono',monospace; font-size:0.5rem; font-weight:700;
  width:13px; height:13px; border-radius:50%;
  display:none; align-items:center; justify-content:center;
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   LIVE STATS BANNER
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.stats-banner {
  display:grid; grid-template-columns:repeat(3,1fr);
  gap:1px; background:var(--border);
  border-bottom:1px solid var(--border);
  position:relative; z-index:1;
}
.stat-cell {
  background:var(--bg2); padding:10px 16px;
  display:flex; flex-direction:column; align-items:center; gap:2px;
  transition:background 0.3s;
}
.stat-cell:hover { background:var(--sur); }
.stat-cell-icon { font-size:0.9rem; }
.stat-cell-val {
  font-family:'Playfair Display',serif; font-size:1.3rem; font-weight:700;
  color:var(--text); transition:color 0.4s;
}
.stat-cell-val.flash { color:var(--gold2) !important; }
.stat-cell-lbl { font-family:'JetBrains Mono',monospace; font-size:0.55rem; letter-spacing:0.1em; text-transform:uppercase; color:var(--muted); }
.stat-cell.free .stat-cell-val { color:var(--green); }
.stat-cell.free .stat-cell-icon { color:var(--green); }

/* Free ticket ribbon */
.free-ribbon {
  background:linear-gradient(90deg,var(--greendim),rgba(61,214,140,0.06));
  border:1px solid rgba(61,214,140,0.2); border-radius:var(--r10);
  padding:10px 16px; margin-bottom:16px;
  display:flex; align-items:center; gap:10px;
  animation:slideDown 0.4s var(--ease) both;
}
@keyframes slideDown { from{opacity:0;transform:translateY(-8px)} to{opacity:1;transform:translateY(0)} }
.free-ribbon-icon { font-size:1.4rem; flex-shrink:0; }
.free-ribbon-text h4 { font-size:0.9rem; font-weight:600; color:var(--green); margin-bottom:2px; }
.free-ribbon-text p { font-family:'JetBrains Mono',monospace; font-size:0.62rem; color:var(--muted); letter-spacing:0.04em; }
.free-ribbon.hidden { display:none; }

/* Sold out banner */
.soldout-banner {
  background:linear-gradient(135deg,var(--reddim),rgba(240,82,82,0.06));
  border:1px solid rgba(240,82,82,0.25); border-radius:var(--r14);
  padding:24px; text-align:center; margin:20px 0;
}
.soldout-banner h3 { font-family:'Playfair Display',serif; font-size:1.4rem; color:var(--red); margin-bottom:8px; }
.soldout-banner p { font-family:'JetBrains Mono',monospace; font-size:0.65rem; color:var(--muted); letter-spacing:0.05em; }

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   MAIN LAYOUT
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.wrap { max-width:620px; margin:0 auto; padding:0 16px 120px; position:relative; z-index:1; }
.view { display:none; }
.view.active { display:block; animation:viewIn 0.4s var(--ease) both; }
@keyframes viewIn { from{opacity:0;transform:translateY(14px)} to{opacity:1;transform:translateY(0)} }

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   HERO
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.hero { text-align:center; padding:40px 0 32px; position:relative; }
.hero::before {
  content:''; position:absolute; inset:0;
  background:radial-gradient(ellipse 70% 50% at 50% 0%, rgba(212,168,67,0.07), transparent 70%);
  pointer-events:none;
}
.hero-eyebrow {
  display:inline-flex; align-items:center; gap:8px;
  font-family:'JetBrains Mono',monospace; font-size:0.62rem; letter-spacing:0.22em;
  text-transform:uppercase; color:var(--gold);
  margin-bottom:14px;
}
.hero-eyebrow::before, .hero-eyebrow::after {
  content:''; display:block; width:24px; height:1px;
  background:var(--gold); opacity:0.4;
}
.hero h1 {
  font-family:'Playfair Display',serif; font-weight:900;
  font-size:clamp(2.6rem,9vw,5rem); line-height:1.0;
  background:linear-gradient(135deg,var(--gold3) 0%,var(--gold2) 45%,var(--gold) 75%,#7a5510 100%);
  -webkit-background-clip:text; -webkit-text-fill-color:transparent; background-clip:text;
  margin-bottom:12px;
}
.hero h1 em { font-style:italic; }
.hero-desc { color:var(--muted); font-size:0.9rem; max-width:400px; margin:0 auto 22px; line-height:1.7; }
.event-pill {
  display:inline-flex; align-items:center; gap:8px;
  background:var(--sur2); border:1px solid var(--border2);
  border-radius:100px; padding:7px 16px;
  font-family:'JetBrains Mono',monospace; font-size:0.65rem; letter-spacing:0.04em; color:var(--text);
}
.event-pill span { color:var(--gold2); }

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   WIZARD PROGRESS
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.wizard {
  display:flex; align-items:center;
  margin:24px 0 28px; padding:0 4px;
  font-family:'JetBrains Mono',monospace; font-size:0.6rem; letter-spacing:0.06em;
}
.wstep { flex:1; display:flex; flex-direction:column; align-items:center; gap:5px; position:relative; }
.wstep::after {
  content:''; position:absolute; top:13px; left:50%;
  width:100%; height:1px; background:var(--sur4);
  transition:background 0.4s;
}
.wstep:last-child::after { display:none; }
.wstep.done::after { background:var(--gold); }
.wnum {
  width:26px; height:26px; border-radius:50%;
  border:1.5px solid var(--sur4); background:var(--sur);
  display:flex; align-items:center; justify-content:center;
  font-size:0.68rem; color:var(--muted);
  position:relative; z-index:1; transition:all 0.3s;
}
.wstep.active .wnum { border-color:var(--gold2); background:var(--goldglow); color:var(--gold2); box-shadow:0 0 14px var(--goldglow); }
.wstep.done  .wnum { border-color:var(--gold); background:var(--gold); color:var(--bg); }
.wstep.done  .wnum::after { content:'âœ“'; }
.wstep.done  .wnum span { display:none; }
.wlabel { color:var(--faint); text-align:center; text-transform:uppercase; }
.wstep.active .wlabel { color:var(--gold2); }
.wstep.done   .wlabel { color:var(--muted); }

/* Step panels */
.step-pane { display:none; }
.step-pane.active { display:block; animation:stepIn 0.35s var(--ease) both; }
@keyframes stepIn { from{opacity:0;transform:translateX(18px)} to{opacity:1;transform:translateX(0)} }

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   CARDS / PANELS
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.card {
  background:var(--sur); border:1px solid var(--border);
  border-radius:var(--r20); padding:22px;
  margin-bottom:14px; position:relative; overflow:hidden;
}
.card::before {
  content:''; position:absolute; top:0; left:0; right:0; height:1px;
  background:linear-gradient(90deg,transparent,var(--goldrim),transparent);
  opacity:0; transition:opacity 0.3s;
}
.card:hover::before { opacity:1; }
.card-title {
  font-family:'Playfair Display',serif; font-size:1rem; font-weight:700;
  color:var(--text); margin-bottom:18px;
  display:flex; align-items:center; gap:9px;
}
.sec-label {
  font-family:'JetBrains Mono',monospace; font-size:0.6rem; letter-spacing:0.2em;
  text-transform:uppercase; color:var(--gold);
  padding-left:11px; border-left:2px solid var(--gold);
  margin-bottom:14px;
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   MOVIE CARD
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.movie-card {
  background:linear-gradient(140deg,var(--sur2),var(--sur));
  border:1.5px solid var(--border2);
  border-radius:var(--r20); padding:18px;
  display:flex; gap:14px; align-items:flex-start;
  margin-bottom:18px; position:relative; overflow:hidden;
  cursor:pointer; transition:all 0.3s;
}
.movie-card::after {
  content:''; position:absolute; inset:0;
  background:radial-gradient(ellipse 80% 60% at 50% 0%, rgba(212,168,67,0.04), transparent);
  pointer-events:none;
}
.movie-card:hover { border-color:var(--goldrim); transform:translateY(-2px); box-shadow:0 8px 32px rgba(0,0,0,0.5); }
.movie-card.selected { border-color:var(--gold2); box-shadow:0 0 0 2px var(--goldglow), 0 8px 32px rgba(0,0,0,0.5); }
.poster {
  width:58px; height:82px; border-radius:10px;
  background:linear-gradient(160deg,#2a1f0e,#140f06);
  border:1px solid var(--goldrim);
  display:flex; align-items:center; justify-content:center;
  font-size:1.7rem; flex-shrink:0;
}
.movie-info h3 { font-family:'Playfair Display',serif; font-size:1rem; font-weight:700; margin-bottom:5px; }
.movie-tags { display:flex; flex-wrap:wrap; gap:6px; margin-bottom:8px; }
.movie-tag {
  background:var(--sur3); border-radius:4px; padding:2px 7px;
  font-family:'JetBrains Mono',monospace; font-size:0.6rem; color:var(--muted);
}
.movie-price { font-family:'Playfair Display',serif; font-size:1.15rem; color:var(--gold2); font-weight:700; }
.movie-price.free-price { color:var(--green); }
.sel-badge {
  position:absolute; top:11px; right:11px;
  background:var(--gold2); color:var(--bg);
  font-family:'JetBrains Mono',monospace; font-size:0.55rem; letter-spacing:0.1em;
  padding:3px 8px; border-radius:4px; font-weight:700;
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   QTY SELECTOR
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.qty-row {
  display:flex; align-items:center; justify-content:space-between;
  background:var(--sur2); border:1px solid var(--border);
  border-radius:var(--r14); padding:14px 18px; margin-bottom:14px;
}
.qty-lbl { font-family:'JetBrains Mono',monospace; font-size:0.7rem; color:var(--muted); letter-spacing:0.05em; }
.qty-ctrl { display:flex; align-items:center; gap:12px; }
.qty-btn {
  width:32px; height:32px; border-radius:50%;
  border:1.5px solid var(--goldrim); background:transparent;
  color:var(--gold2); font-size:1.1rem; cursor:pointer;
  display:flex; align-items:center; justify-content:center;
  transition:all 0.2s;
}
.qty-btn:hover { background:var(--goldglow); }
.qty-btn:active { transform:scale(0.88); }
.qty-btn:disabled { opacity:0.3; cursor:not-allowed; }
.qty-num {
  font-family:'Playfair Display',serif; font-size:1.9rem; font-weight:700;
  color:var(--text); min-width:34px; text-align:center;
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   PRICE BREAKDOWN
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.price-box {
  background:linear-gradient(140deg,rgba(212,168,67,0.06),rgba(212,168,67,0.02));
  border:1px solid var(--goldrim); border-radius:var(--r14);
  padding:16px 18px; font-family:'JetBrains Mono',monospace;
  margin-bottom:18px; position:relative; overflow:hidden;
}
.price-box::before {
  content:'PRICE BREAKDOWN'; position:absolute; top:8px; right:12px;
  font-size:0.5rem; letter-spacing:0.2em; color:var(--gold); opacity:0.5;
}
.pr-row { display:flex; justify-content:space-between; align-items:center; padding:5px 0; }
.pr-row .k { font-size:0.68rem; color:var(--muted); }
.pr-row .v { font-size:0.75rem; color:var(--text); }
.pr-row.free-row .v { color:var(--green); font-weight:700; }
.pr-row.total-row { border-top:1px solid var(--goldrim); margin-top:8px; padding-top:12px; }
.pr-row.total-row .k { color:var(--gold); font-weight:500; }
.pr-row.total-row .v { color:var(--gold2); font-size:1.05rem; font-family:'Playfair Display',serif; font-weight:700; }
.free-badge-inline {
  display:inline-flex; align-items:center; gap:4px;
  background:var(--greendim); border:1px solid rgba(61,214,140,0.25);
  color:var(--green); font-size:0.6rem; padding:2px 7px; border-radius:100px;
  vertical-align:middle; margin-left:6px;
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   FORM
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.fg { margin-bottom:16px; }
.fl {
  display:block; font-family:'JetBrains Mono',monospace; font-size:0.6rem;
  letter-spacing:0.15em; text-transform:uppercase; color:var(--muted); margin-bottom:7px;
}
.fi {
  width:100%; padding:12px 14px;
  background:var(--sur2); border:1px solid var(--border);
  border-radius:var(--r10); color:var(--text);
  font-family:'Outfit',sans-serif; font-size:0.92rem;
  transition:all 0.25s; outline:none;
}
.fi:focus { border-color:var(--goldrim); box-shadow:0 0 0 3px rgba(212,168,67,0.07); background:var(--sur3); }
.fi::placeholder { color:var(--faint); }
.fi.err { border-color:rgba(240,82,82,0.5); }
.ferr { font-family:'JetBrains Mono',monospace; font-size:0.6rem; color:var(--red); margin-top:4px; display:none; }
.ferr.show { display:block; animation:errPop 0.2s ease; }
@keyframes errPop { from{opacity:0;transform:translateY(-3px)} to{opacity:1;transform:translateY(0)} }

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   PAYMENT STEP
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.upi-panel {
  background:linear-gradient(140deg,var(--sur2),var(--sur3));
  border:1.5px solid var(--goldrim); border-radius:var(--r20);
  padding:22px; margin-bottom:14px; position:relative; overflow:hidden;
}
.upi-panel::before {
  content:''; position:absolute; top:-40%; left:-40%; width:180%; height:180%;
  background:radial-gradient(circle, rgba(212,168,67,0.04), transparent 55%);
  pointer-events:none;
}
.upi-amt {
  font-family:'Playfair Display',serif; font-size:2.8rem; font-weight:900;
  color:var(--gold2); text-align:center; margin-bottom:4px;
  transition:color 0.4s;
}
.upi-amt.free { color:var(--green); }
.upi-sub { font-family:'JetBrains Mono',monospace; font-size:0.6rem; letter-spacing:0.18em; color:var(--muted); text-align:center; text-transform:uppercase; margin-bottom:18px; }
.upi-id-row {
  background:var(--bg); border:1px solid var(--goldrim);
  border-radius:var(--r10); padding:11px 14px;
  display:flex; justify-content:space-between; align-items:center; margin-bottom:8px;
}
.upi-id-txt { font-family:'JetBrains Mono',monospace; font-size:0.78rem; color:var(--gold3); letter-spacing:0.04em; }
.copy-btn {
  background:var(--goldglow); border:1px solid var(--goldrim);
  color:var(--gold2); font-family:'JetBrains Mono',monospace;
  font-size:0.6rem; letter-spacing:0.08em; padding:4px 9px;
  border-radius:5px; cursor:pointer; transition:all 0.2s;
}
.copy-btn:hover { background:rgba(212,168,67,0.2); }
.upi-apps { display:flex; gap:8px; justify-content:center; flex-wrap:wrap; margin:14px 0; }
.app-pill {
  background:var(--sur3); border:1px solid var(--border);
  border-radius:var(--r10); padding:7px 13px;
  font-family:'JetBrains Mono',monospace; font-size:0.62rem;
  color:var(--muted); cursor:pointer; transition:all 0.2s;
  text-decoration:none; display:inline-flex; align-items:center; gap:5px;
}
.app-pill:hover { border-color:var(--goldrim); color:var(--gold2); background:var(--goldglow); }
.free-pay-notice {
  background:var(--greendim); border:1px solid rgba(61,214,140,0.2);
  border-radius:var(--r10); padding:14px 16px; text-align:center;
  font-family:'JetBrains Mono',monospace; font-size:0.7rem; color:var(--green);
  letter-spacing:0.04em; margin-bottom:14px;
}
.free-pay-notice strong { display:block; font-size:0.85rem; margin-bottom:4px; }

/* Upload */
.upload-zone {
  border:2px dashed rgba(255,255,255,0.1); border-radius:var(--r14);
  padding:26px 18px; text-align:center; cursor:pointer;
  transition:all 0.3s; position:relative; overflow:hidden; margin-bottom:14px;
}
.upload-zone:hover, .upload-zone.over { border-color:var(--goldrim); background:rgba(212,168,67,0.02); }
.upload-zone input { position:absolute; inset:0; opacity:0; cursor:pointer; width:100%; height:100%; }
.upload-icon { font-size:1.8rem; margin-bottom:7px; }
.upload-title { font-family:'Playfair Display',serif; font-size:0.95rem; margin-bottom:3px; }
.upload-sub { font-family:'JetBrains Mono',monospace; font-size:0.6rem; color:var(--muted); letter-spacing:0.05em; }
#previewImg { width:100%; border-radius:var(--r10); margin-top:10px; display:none; max-height:180px; object-fit:cover; border:1px solid var(--goldrim); }

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   BUTTONS
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.btn {
  display:flex; align-items:center; justify-content:center; gap:8px;
  width:100%; padding:13px 22px;
  border-radius:var(--r10); border:none; cursor:pointer;
  font-family:'JetBrains Mono',monospace; font-size:0.75rem;
  letter-spacing:0.1em; text-transform:uppercase; font-weight:500;
  transition:all 0.25s; appearance:none; text-decoration:none;
}
.btn-gold {
  background:linear-gradient(135deg,var(--gold),var(--gold2));
  color:var(--bg); box-shadow:0 4px 18px rgba(212,168,67,0.22);
}
.btn-gold:hover { box-shadow:0 6px 28px rgba(212,168,67,0.38); transform:translateY(-1px); }
.btn-gold:active { transform:translateY(0); }
.btn-gold:disabled { opacity:0.4; cursor:not-allowed; transform:none !important; box-shadow:none; }
.btn-ghost { background:transparent; border:1.5px solid var(--border2); color:var(--muted); }
.btn-ghost:hover { border-color:var(--goldrim); color:var(--gold2); }
.btn-red { background:var(--reddim); border:1.5px solid rgba(240,82,82,0.25); color:var(--red); }
.btn-sm { padding:7px 13px; font-size:0.6rem; width:auto; border-radius:6px; }
.btn-row { display:flex; gap:9px; margin-top:14px; }
.btn-row .btn { flex:1; }
.spin { display:inline-block; width:15px; height:15px; border:2px solid rgba(255,255,255,0.2); border-top-color:currentColor; border-radius:50%; animation:spin360 0.6s linear infinite; }
@keyframes spin360 { to{transform:rotate(360deg)} }

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   GENERATED TICKET â€” CINEMATIC
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.ticket-shell {
  position:relative; margin-bottom:18px;
  filter:drop-shadow(0 0 30px rgba(212,168,67,0.1));
}
.ticket-shell::before {
  content:''; position:absolute; inset:-1px; border-radius:22px; z-index:-1;
  background:linear-gradient(135deg,var(--gold),var(--gold2) 40%,var(--gold3) 60%,var(--gold));
  animation:ticketGlow 3s ease-in-out infinite;
}
@keyframes ticketGlow { 0%,100%{opacity:0.5} 50%{opacity:1} }

.ticket {
  background:linear-gradient(160deg,#1e1508,#110d06,#0d0a05);
  border-radius:21px; overflow:hidden; position:relative;
}

/* Poster blurred bg strip */
.ticket-bg {
  position:absolute; inset:0;
  background:linear-gradient(135deg,rgba(212,168,67,0.08) 0%,transparent 50%,rgba(96,165,250,0.05) 100%);
  pointer-events:none;
}

/* Film perfs */
.ticket-perfs {
  position:absolute; top:0; bottom:0; left:0; width:38px;
  background:repeating-linear-gradient(
    to bottom,
    #06050a 0,#06050a 5px,
    rgba(212,168,67,0.08) 5px, rgba(212,168,67,0.08) 22px
  );
  border-right:1px solid rgba(212,168,67,0.12);
}
.ticket-perfs span {
  position:absolute; left:5px; top:50%; transform:translateY(-50%) rotate(180deg);
  writing-mode:vertical-rl;
  font-family:'JetBrains Mono',monospace; font-size:0.48rem; letter-spacing:0.2em;
  color:rgba(212,168,67,0.2); text-transform:uppercase;
}

.ticket-head {
  padding:20px 20px 16px 52px; position:relative;
  background:linear-gradient(160deg,rgba(212,168,67,0.1),transparent 70%);
}
.t-brand {
  font-family:'JetBrains Mono',monospace; font-size:0.55rem; letter-spacing:0.28em;
  text-transform:uppercase; color:var(--gold); margin-bottom:5px;
  display:flex; align-items:center; gap:6px;
}
.t-movie { font-family:'Playfair Display',serif; font-size:1.45rem; font-weight:900; line-height:1.1; margin-bottom:9px; }
.t-meta { display:flex; flex-wrap:wrap; gap:12px; }
.t-meta-item { display:flex; flex-direction:column; gap:2px; }
.t-meta-k { font-family:'JetBrains Mono',monospace; font-size:0.5rem; letter-spacing:0.12em; text-transform:uppercase; color:var(--faint); }
.t-meta-v { font-family:'JetBrains Mono',monospace; font-size:0.72rem; color:var(--text); }

/* Tear line */
.tear-line {
  height:1px; background:rgba(212,168,67,0.15); position:relative; margin:0;
}
.tear-line::before, .tear-line::after {
  content:''; position:absolute; top:-8px;
  width:16px; height:16px; border-radius:50%;
  background:var(--bg); border:1px solid rgba(212,168,67,0.15);
}
.tear-line::before { left:-8px; }
.tear-line::after  { right:-8px; }
/* Perforated dashes */
.tear-dashes {
  position:absolute; top:0; left:20px; right:20px;
  border-top:1px dashed rgba(212,168,67,0.12);
}

.ticket-body {
  padding:16px 20px 16px 52px;
  display:flex; justify-content:space-between; align-items:center; gap:12px;
}
.t-details { flex:1; }
.t-detail-row {
  display:flex; justify-content:space-between; padding:5px 0;
  border-bottom:1px solid rgba(255,255,255,0.04);
}
.t-detail-row:last-child { border:none; }
.t-dk { font-family:'JetBrains Mono',monospace; font-size:0.58rem; letter-spacing:0.08em; text-transform:uppercase; color:var(--faint); }
.t-dv { font-family:'JetBrains Mono',monospace; font-size:0.68rem; color:var(--text); }
.t-dv.gold { color:var(--gold2); }
.t-dv.green { color:var(--green); }

/* QR area */
.ticket-qr { flex-shrink:0; display:flex; flex-direction:column; align-items:center; gap:5px; }
#qrDiv { background:#fff; border-radius:6px; padding:5px; display:inline-block; }
#qrDiv img, #qrDiv canvas { display:block !important; }
.t-qr-lbl { font-family:'JetBrains Mono',monospace; font-size:0.5rem; letter-spacing:0.1em; color:var(--faint); text-transform:uppercase; }

.ticket-foot {
  padding:11px 20px 11px 52px;
  background:rgba(0,0,0,0.3);
  border-top:1px solid rgba(212,168,67,0.08);
  display:flex; justify-content:space-between; align-items:center;
}
.t-tid { font-family:'JetBrains Mono',monospace; font-size:0.65rem; color:var(--gold); letter-spacing:0.1em; }

/* Status badges */
.sbadge {
  display:inline-flex; align-items:center; gap:5px;
  padding:4px 11px; border-radius:100px;
  font-family:'JetBrains Mono',monospace; font-size:0.58rem;
  letter-spacing:0.1em; text-transform:uppercase; font-weight:700;
}
.sb-pending  { background:var(--yellowdim); color:var(--yellow);  border:1px solid rgba(251,191,36,0.25); }
.sb-review   { background:var(--bluedim);   color:var(--blue);    border:1px solid rgba(96,165,250,0.25); }
.sb-approved { background:var(--greendim);  color:var(--green);   border:1px solid rgba(61,214,140,0.3);  animation:approvedPulse 2s infinite; }
.sb-rejected { background:var(--reddim);    color:var(--red);     border:1px solid rgba(240,82,82,0.25); }
.sb-free     { background:var(--greendim);  color:var(--green);   border:1px solid rgba(61,214,140,0.3); }
@keyframes approvedPulse { 0%,100%{box-shadow:0 0 6px rgba(61,214,140,0.15)} 50%{box-shadow:0 0 18px rgba(61,214,140,0.35)} }
.sbadge .sd { width:5px; height:5px; border-radius:50%; background:currentColor; animation:sdBlink 1.8s infinite; }
@keyframes sdBlink { 0%,100%{opacity:1} 50%{opacity:0.25} }

/* Free stamp on ticket */
.free-stamp {
  position:absolute; top:16px; right:16px;
  background:linear-gradient(135deg,var(--green),#20c770);
  color:#fff; font-family:'JetBrains Mono',monospace;
  font-size:0.58rem; letter-spacing:0.15em; font-weight:700;
  padding:4px 10px; border-radius:5px;
  box-shadow:0 0 14px rgba(61,214,140,0.35);
  text-transform:uppercase;
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   MY TICKETS â€” ORDER HISTORY CARDS
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.tcard {
  background:var(--sur); border:1px solid var(--border);
  border-radius:var(--r20); overflow:hidden; margin-bottom:12px;
  transition:all 0.3s; position:relative;
}
.tcard:hover { border-color:rgba(212,168,67,0.18); transform:translateY(-2px); box-shadow:0 10px 32px rgba(0,0,0,0.45); }
.tcard-head {
  padding:14px 16px;
  display:flex; justify-content:space-between; align-items:flex-start;
  border-bottom:1px solid var(--border);
}
.tcard-movie { font-family:'Playfair Display',serif; font-size:0.95rem; font-weight:700; margin-bottom:3px; }
.tcard-id { font-family:'JetBrains Mono',monospace; font-size:0.58rem; color:var(--muted); letter-spacing:0.07em; }
.tcard-body {
  padding:12px 16px;
  display:flex; justify-content:space-between; flex-wrap:wrap; gap:10px;
  border-bottom:1px solid var(--border);
}
.tc-col { display:flex; flex-direction:column; gap:2px; }
.tc-col-lbl { font-family:'JetBrains Mono',monospace; font-size:0.55rem; letter-spacing:0.1em; text-transform:uppercase; color:var(--faint); }
.tc-col-val { font-family:'JetBrains Mono',monospace; font-size:0.75rem; color:var(--text); }
.tc-col-val.green { color:var(--green); }
.tcard-foot { padding:10px 16px; background:rgba(0,0,0,0.15); display:flex; gap:7px; align-items:center; }
.tcard-free-strip {
  position:absolute; left:0; top:0; bottom:0; width:3px;
  background:linear-gradient(to bottom,var(--green),#20c770);
}

/* Skeleton loaders */
.skel { background:linear-gradient(90deg,var(--sur2) 25%,var(--sur3) 50%,var(--sur2) 75%); background-size:400% 100%; animation:skelAnim 1.4s infinite; border-radius:6px; }
@keyframes skelAnim { from{background-position:100% 0} to{background-position:-100% 0} }
.skel-card { height:115px; border-radius:var(--r20); margin-bottom:12px; }

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   NOTIFICATION PANEL
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
#notifPanel {
  position:fixed; top:54px; right:12px; z-index:500;
  width:300px; max-width:calc(100vw - 24px);
  background:var(--sur); border:1px solid var(--border2);
  border-radius:var(--r20); overflow:hidden;
  box-shadow:0 20px 60px rgba(0,0,0,0.7);
  display:none;
}
#notifPanel.open { display:block; animation:notifIn 0.2s var(--ease); }
@keyframes notifIn { from{opacity:0;transform:translateY(-8px) scale(0.97)} to{opacity:1;transform:none} }
.notif-head { padding:12px 16px; background:rgba(0,0,0,0.2); font-family:'JetBrains Mono',monospace; font-size:0.65rem; letter-spacing:0.12em; text-transform:uppercase; color:var(--gold); display:flex; justify-content:space-between; align-items:center; }
.notif-clear { background:none; border:none; color:var(--muted); cursor:pointer; font-size:0.65rem; font-family:'JetBrains Mono',monospace; transition:color 0.2s; }
.notif-clear:hover { color:var(--red); }
.notif-item { padding:11px 16px; border-bottom:1px solid var(--border); transition:background 0.15s; }
.notif-item:last-child { border:none; }
.notif-item:hover { background:rgba(255,255,255,0.02); }
.ni-msg { font-size:0.8rem; color:var(--text); margin-bottom:2px; }
.ni-time { font-family:'JetBrains Mono',monospace; font-size:0.55rem; color:var(--muted); }
.notif-empty { padding:24px; text-align:center; font-family:'JetBrains Mono',monospace; font-size:0.65rem; color:var(--faint); }

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   TOAST
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
#toastWrap { position:fixed; bottom:20px; left:50%; transform:translateX(-50%); z-index:9000; display:flex; flex-direction:column; gap:7px; align-items:center; pointer-events:none; }
.toast {
  background:var(--sur2); border:1px solid var(--border2);
  border-radius:100px; padding:9px 18px;
  font-family:'JetBrains Mono',monospace; font-size:0.68rem; letter-spacing:0.04em;
  color:var(--text); white-space:nowrap; pointer-events:auto;
  animation:toastUp 0.3s var(--ease) both;
  box-shadow:0 8px 28px rgba(0,0,0,0.6);
}
.toast.ok  { border-color:rgba(61,214,140,0.3); background:rgba(61,214,140,0.09); color:var(--green); }
.toast.err { border-color:rgba(240,82,82,0.3);  background:rgba(240,82,82,0.09);  color:var(--red); }
.toast.warn{ border-color:rgba(251,191,36,0.3);  background:rgba(251,191,36,0.08); color:var(--yellow); }
@keyframes toastUp { from{opacity:0;transform:translateY(8px) scale(0.95)} to{opacity:1;transform:none} }
.toast.bye { animation:toastBye 0.22s ease forwards; }
@keyframes toastBye { to{opacity:0;transform:scale(0.9)} }

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   EMPTY STATE
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.empty { text-align:center; padding:56px 20px; }
.empty-ico { font-size:2.8rem; margin-bottom:12px; opacity:0.35; }
.empty-ttl { font-family:'Playfair Display',serif; font-size:1.15rem; color:var(--muted); margin-bottom:7px; }
.empty-sub { font-family:'JetBrains Mono',monospace; font-size:0.6rem; letter-spacing:0.06em; color:var(--faint); }
</style>
</head>
<body>

<!-- Ambient orbs -->
<div class="orb orb-1"></div>
<div class="orb orb-2"></div>
<div class="orb orb-3"></div>

<!-- â”€â”€ SPLASH â”€â”€ -->
<div id="splash">
  <div class="sp-icon">ğŸ¬</div>
  <div class="sp-logo">Reel <em>to</em> Deal</div>
  <div class="sp-sub">Premium Cinema Experience</div>
  <div class="sp-track"><div class="sp-fill"></div></div>
</div>

<!-- â”€â”€ TOPBAR â”€â”€ -->
<nav id="topbar">
  <div class="tb-brand">Reel <em>to</em> Deal</div>
  <div class="tb-right">
    <div class="sync-chip"><div class="sync-dot" id="syncDot"></div><span id="syncLbl">â€”</span></div>
    <button class="nav-pill active" data-v="book" onclick="gotoView('book',this)">Book</button>
    <button class="nav-pill" data-v="tickets" onclick="gotoView('tickets',this)">My Tickets</button>
    <button class="bell-btn" onclick="toggleNotif()" id="bellBtn">
      ğŸ””<span class="bell-badge" id="bellBadge"></span>
    </button>
  </div>
</nav>

<!-- â”€â”€ LIVE STATS BANNER â”€â”€ -->
<div class="stats-banner" id="statsBanner">
  <div class="stat-cell">
    <span class="stat-cell-icon">ğŸŸ</span>
    <span class="stat-cell-val" id="bannerTotal">â€”</span>
    <span class="stat-cell-lbl">Total Seats</span>
  </div>
  <div class="stat-cell">
    <span class="stat-cell-icon">ğŸ«</span>
    <span class="stat-cell-val" id="bannerSold">â€”</span>
    <span class="stat-cell-lbl">Sold</span>
  </div>
  <div class="stat-cell free">
    <span class="stat-cell-icon">âœ¨</span>
    <span class="stat-cell-val" id="bannerFree">â€”</span>
    <span class="stat-cell-lbl">Free Left</span>
  </div>
</div>

<!-- Notification panel -->
<div id="notifPanel">
  <div class="notif-head">
    <span>Notifications</span>
    <button class="notif-clear" onclick="clearNotifs()">Clear all</button>
  </div>
  <div id="notifList"><div class="notif-empty">No notifications yet</div></div>
</div>

<!-- Toast container -->
<div id="toastWrap"></div>

<!-- â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ -->
<div class="wrap">

  <!-- â•â• BOOK VIEW â•â• -->
  <div class="view active" id="view-book">
    <div class="hero">
      <div class="hero-eyebrow">ğŸ MBA Fest 2025</div>
      <h1>Reel <em>to</em> Deal</h1>
      <p class="hero-desc">Experience cinema like never before. Premium seats, unforgettable moments.</p>
      <div class="event-pill">ğŸ“ <span id="herVenue">MBA Auditorium</span>&nbsp;Â·&nbsp;<span id="herDate">â€”</span></div>
    </div>

    <!-- SOLD OUT STATE -->
    <div class="soldout-banner" id="soldoutBanner" style="display:none">
      <h3>ğŸŸ Sold Out!</h3>
      <p>All tickets have been claimed. Check back later or contact the organiser.</p>
    </div>

    <!-- BOOKING DISABLED STATE -->
    <div class="soldout-banner" id="disabledBanner" style="display:none; border-color:rgba(251,191,36,0.25); background:var(--yellowdim)">
      <h3 style="color:var(--yellow)">â¸ Bookings Paused</h3>
      <p>The admin has temporarily paused ticket bookings.</p>
    </div>

    <!-- WIZARD + BOOKING FORM (hidden when sold out) -->
    <div id="bookingForm">
      <!-- Wizard progress -->
      <div class="wizard" id="wizBar">
        <div class="wstep active" id="ws1"><div class="wnum"><span>1</span></div><div class="wlabel">Select</div></div>
        <div class="wstep" id="ws2"><div class="wnum"><span>2</span></div><div class="wlabel">Details</div></div>
        <div class="wstep" id="ws3"><div class="wnum"><span>3</span></div><div class="wlabel">Payment</div></div>
        <div class="wstep" id="ws4"><div class="wnum"><span>4</span></div><div class="wlabel">Ticket</div></div>
      </div>

      <!-- â”€ STEP 1: SELECT â”€ -->
      <div class="step-pane active" id="step1">
        <!-- Free ticket ribbon -->
        <div class="free-ribbon" id="freeRibbon">
          <div class="free-ribbon-icon">ğŸ</div>
          <div class="free-ribbon-text">
            <h4>Free Tickets Available!</h4>
            <p>You qualify for a <strong>FREE</strong> ticket â€” <span id="ribbonCount">0</span> remaining</p>
          </div>
        </div>

        <p class="sec-label">Now Showing</p>
        <div class="movie-card selected" id="movieCard">
          <div class="poster">ğŸ­</div>
          <div class="movie-info">
            <h3 id="mc-name">Reel to Deal</h3>
            <div class="movie-tags">
              <span class="movie-tag">Drama Â· Thriller</span>
              <span class="movie-tag">2h 15m</span>
            </div>
            <div class="movie-price" id="mc-price">â‚¹100<small style="font-size:0.6rem;font-family:'JetBrains Mono',monospace;color:var(--muted)">/seat</small></div>
          </div>
          <div class="sel-badge">Selected</div>
        </div>

        <p class="sec-label" style="margin-top:18px">How many seats?</p>
        <div class="qty-row">
          <span class="qty-lbl">Quantity</span>
          <div class="qty-ctrl">
            <button class="qty-btn" id="qtyMinus" onclick="chgQty(-1)">âˆ’</button>
            <span class="qty-num" id="qtyNum">1</span>
            <button class="qty-btn" id="qtyPlus" onclick="chgQty(1)">+</button>
          </div>
        </div>

        <div class="price-box" id="priceBox">
          <div class="pr-row"><span class="k">Price per seat</span><span class="v" id="pricePer">â‚¹100</span></div>
          <div class="pr-row" id="freeRow" style="display:none"><span class="k">Free seats applied</span><span class="v free-row" id="freeSeats">0</span></div>
          <div class="pr-row"><span class="k">Seats selected</span><span class="v" id="priceQty">1</span></div>
          <div class="pr-row"><span class="k">Convenience fee</span><span class="v">â‚¹0</span></div>
          <div class="pr-row total-row"><span class="k">Total Amount</span><span class="v" id="priceTotal">â‚¹100</span></div>
        </div>
        <button class="btn btn-gold" onclick="goStep(2)">Continue to Details â†’</button>
      </div>

      <!-- â”€ STEP 2: DETAILS â”€ -->
      <div class="step-pane" id="step2">
        <div class="card">
          <div class="card-title">ğŸ‘¤ Personal Information</div>
          <div class="fg">
            <label class="fl">Full Name *</label>
            <input class="fi" id="inName" type="text" placeholder="Your full name" oninput="vf('inName')">
            <div class="ferr" id="eN">Name must be at least 2 characters</div>
          </div>
          <div class="fg">
            <label class="fl">Email Address *</label>
            <input class="fi" id="inEmail" type="email" placeholder="you@college.edu" oninput="vf('inEmail')">
            <div class="ferr" id="eE">Enter a valid email address</div>
          </div>
          <div class="fg">
            <label class="fl">Mobile Number *</label>
            <input class="fi" id="inPhone" type="tel" placeholder="10-digit number" maxlength="10" oninput="vf('inPhone')">
            <div class="ferr" id="eP">Enter a valid 10-digit mobile number</div>
          </div>
          <div class="fg">
            <label class="fl">College / Organisation</label>
            <input class="fi" id="inCollege" type="text" placeholder="Optional">
          </div>
        </div>
        <div class="btn-row">
          <button class="btn btn-ghost" onclick="goStep(1)">â† Back</button>
          <button class="btn btn-gold" onclick="goStep(3)">Proceed to Payment â†’</button>
        </div>
      </div>

      <!-- â”€ STEP 3: PAYMENT â”€ -->
      <div class="step-pane" id="step3">
        <!-- Free ticket: no payment needed -->
        <div id="freePaySection" style="display:none">
          <div class="free-pay-notice">
            <strong>ğŸ This is a FREE Ticket!</strong>
            No payment required. Just submit your details below to claim your seat.
          </div>
        </div>

        <!-- Paid: show UPI panel -->
        <div id="paidPaySection">
          <div class="upi-panel">
            <div class="upi-amt" id="upiAmt">â‚¹100</div>
            <div class="upi-sub">Amount to pay via UPI</div>
            <div class="upi-id-row">
              <span class="upi-id-txt" id="upiIdTxt">rtd@upi</span>
              <button class="copy-btn" onclick="copyUPI()">Copy</button>
            </div>
            <div class="upi-apps">
              <a class="app-pill" onclick="openUPI('gpay')">ğŸŸ¢ GPay</a>
              <a class="app-pill" onclick="openUPI('phonepe')">ğŸ’œ PhonePe</a>
              <a class="app-pill" onclick="openUPI('paytm')">ğŸ”µ Paytm</a>
              <a class="app-pill" onclick="openUPI('bhim')">ğŸ› BHIM</a>
            </div>
            <div style="font-family:'JetBrains Mono',monospace;font-size:0.6rem;color:var(--muted);text-align:center;letter-spacing:0.04em;">
              ğŸ’¡ Pay exact amount Â· Screenshot required for verification
            </div>
          </div>
          <div class="card">
            <div class="card-title">ğŸ“¸ Payment Screenshot</div>
            <div class="upload-zone" id="uploadZone">
              <input type="file" id="ssFile" accept="image/*" onchange="onFileSelect(event)">
              <div class="upload-icon">ğŸ“</div>
              <div class="upload-title">Drop screenshot here</div>
              <div class="upload-sub">Click to browse Â· JPG PNG WEBP</div>
              <img id="previewImg" alt="Preview">
            </div>
          </div>
        </div>

        <div class="card">
          <div class="card-title">ğŸ§¾ Transaction Details</div>
          <div class="fg">
            <label class="fl" id="utrLabel">UTR / Transaction ID *</label>
            <input class="fi" id="inUTR" type="text" placeholder="Transaction reference number" oninput="vf('inUTR')">
            <div class="ferr" id="eU">Enter a valid UTR (min. 6 characters)</div>
          </div>
        </div>

        <div class="btn-row">
          <button class="btn btn-ghost" onclick="goStep(2)">â† Back</button>
          <button class="btn btn-gold" id="submitBtn" onclick="submitBooking()">
            <span id="submitTxt">Submit Booking</span>
          </button>
        </div>
      </div>

      <!-- â”€ STEP 4: SUCCESS TICKET â”€ -->
      <div class="step-pane" id="step4">
        <div style="text-align:center;padding:18px 0 26px">
          <div style="font-size:2.8rem;margin-bottom:10px" id="successEmoji">ğŸ‰</div>
          <div style="font-family:'Playfair Display',serif;font-size:1.45rem;font-weight:700;color:var(--gold2);margin-bottom:5px">Booking Submitted!</div>
          <div style="font-family:'JetBrains Mono',monospace;font-size:0.65rem;color:var(--muted);letter-spacing:0.04em" id="s4sub">Pending admin verification</div>
        </div>

        <!-- CINEMATIC TICKET -->
        <div class="ticket-shell" id="ticketShell">
          <div class="ticket" id="tktEl">
            <div class="ticket-bg"></div>
            <div class="ticket-perfs"><span>Reel&nbsp;to&nbsp;Deal</span></div>
            <div class="free-stamp" id="tktFreeStamp" style="display:none">âœ¨ FREE</div>
            <div class="ticket-head">
              <div class="t-brand">ğŸ¬ <span id="tktBrand">Reel to Deal Â· MBA Fest 2025</span></div>
              <div class="t-movie" id="tktMovie">â€”</div>
              <div class="t-meta">
                <div class="t-meta-item"><div class="t-meta-k">Date</div><div class="t-meta-v" id="tktDate">â€”</div></div>
                <div class="t-meta-item"><div class="t-meta-k">Venue</div><div class="t-meta-v" id="tktVenue">â€”</div></div>
                <div class="t-meta-item"><div class="t-meta-k">Seats</div><div class="t-meta-v" id="tktQty">â€”</div></div>
              </div>
            </div>
            <div class="tear-line"><div class="tear-dashes"></div></div>
            <div class="ticket-body">
              <div class="t-details">
                <div class="t-detail-row"><span class="t-dk">Name</span><span class="t-dv" id="tktName">â€”</span></div>
                <div class="t-detail-row"><span class="t-dk">Email</span><span class="t-dv" id="tktEmail">â€”</span></div>
                <div class="t-detail-row"><span class="t-dk">Amount</span><span class="t-dv gold" id="tktAmt">â€”</span></div>
                <div class="t-detail-row"><span class="t-dk">Type</span><span class="t-dv" id="tktType">â€”</span></div>
              </div>
              <div class="ticket-qr">
                <div id="qrDiv"></div>
                <div class="t-qr-lbl">Scan Â· Verify</div>
              </div>
            </div>
            <div class="ticket-foot">
              <div class="t-tid" id="tktTid">â€”</div>
              <div id="tktStatusBadge" class="sbadge sb-pending"><div class="sd"></div>Pending</div>
            </div>
          </div>
        </div>

        <div class="btn-row">
          <button class="btn btn-ghost btn-sm" onclick="dlPDF()" style="flex:1">â¬‡ PDF</button>
          <button class="btn btn-ghost btn-sm" onclick="gotoView('tickets',null)" style="flex:1">ğŸŸ My Tickets</button>
          <button class="btn btn-gold btn-sm" onclick="bookAnother()" style="flex:1">ï¼‹ New</button>
        </div>
      </div>
    </div><!-- /bookingForm -->
  </div><!-- /view-book -->

  <!-- â•â• MY TICKETS VIEW â•â• -->
  <div class="view" id="view-tickets">
    <div style="padding:28px 0 18px">
      <div style="font-family:'Playfair Display',serif;font-size:1.45rem;font-weight:700;margin-bottom:4px">Your Tickets</div>
      <div style="font-family:'JetBrains Mono',monospace;font-size:0.62rem;color:var(--muted);letter-spacing:0.04em">Saved permanently Â· synced in real-time</div>
    </div>
    <div id="skelCards">
      <div class="skel skel-card"></div>
      <div class="skel skel-card"></div>
      <div class="skel skel-card"></div>
    </div>
    <div id="tcardList" style="display:none"></div>
  </div>

</div><!-- /wrap -->

<script>
'use strict';

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  SUPABASE CLIENT
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
const SB_URL = 'https://yhrfpcwehtqsppoifhog.supabase.co';
const SB_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InlocmZwY3dlaHRxc3Bwb2lmaG9nIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NzE1NzQ5MDAsImV4cCI6MjA4NzE1MDkwMH0.Ml1V2zc8j3XCZIuILuapy2Cs4jcBl0i6sHKxFFl6Sqo';
const H = { 'apikey':SB_KEY, 'Authorization':'Bearer '+SB_KEY, 'Content-Type':'application/json', 'Prefer':'return=representation' };

const DB = {
  async get(t,q='')    { const r=await fetch(`${SB_URL}/rest/v1/${t}?${q}`,{headers:H}); if(!r.ok)throw new Error(await r.text()); return r.json(); },
  async post(t,b)      { const r=await fetch(`${SB_URL}/rest/v1/${t}`,{method:'POST',headers:H,body:JSON.stringify(b)}); if(!r.ok)throw new Error(await r.text()); return r.json(); },
  async patch(t,q,b)   { const r=await fetch(`${SB_URL}/rest/v1/${t}?${q}`,{method:'PATCH',headers:H,body:JSON.stringify(b)}); if(!r.ok)throw new Error(await r.text()); return r.json(); },
  async del(t,q)       { const r=await fetch(`${SB_URL}/rest/v1/${t}?${q}`,{method:'DELETE',headers:H}); if(!r.ok)throw new Error(await r.text()); return true; },
  async upload(bucket,path,file) {
    const r=await fetch(`${SB_URL}/storage/v1/object/${bucket}/${path}`,{method:'POST',headers:{'apikey':SB_KEY,'Authorization':'Bearer '+SB_KEY,'Content-Type':file.type},body:file});
    if(!r.ok)throw new Error('Upload failed');
    return `${SB_URL}/storage/v1/object/public/${bucket}/${path}`;
  }
};

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  APP STATE
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
const S = {
  qty:      1,
  step:     1,
  cfg:      { event_name:'Reel to Deal', ticket_price:100, total_tickets:200, free_tickets:50, free_used:0, tickets_sold:0, upi_id:'rtd@upi', venue:'MBA Auditorium', event_date:'Feb 17, 2025 Â· 2:00 PM', booking_enabled:true },
  booking:  null,
  notifs:   [],
  knownSt:  {},
  tickets:  [],         // persisted local cache
  isFreeBooking: false,
};

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  BOOT
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
document.addEventListener('DOMContentLoaded', async () => {
  // Restore local ticket cache
  try { const s=localStorage.getItem('rtd2_tickets'); if(s) S.tickets=JSON.parse(s); } catch(e){}

  await syncSettings();
  initPolling();

  setTimeout(()=>document.getElementById('splash').classList.add('gone'), 1900);
});

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  SETTINGS SYNC
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
async function syncSettings() {
  try {
    const [cfg] = await DB.get('settings','id=eq.1&select=*');
    if (cfg) Object.assign(S.cfg, cfg);
    setSync(true);
  } catch(e) { setSync(false); }
  applySettings();
}

function applySettings() {
  const c = S.cfg;
  const freeLeft = Math.max(0, c.free_tickets - c.free_used);
  const remaining = Math.max(0, c.total_tickets - c.tickets_sold);
  S.isFreeBooking = freeLeft > 0;

  // Banner stats
  animNum('bannerTotal', c.total_tickets);
  animNum('bannerSold',  c.tickets_sold);
  animNum('bannerFree',  freeLeft);

  // Hero info
  _t('herVenue', c.venue);
  _t('herDate', c.event_date);

  // Movie card price
  const priceDisplay = S.isFreeBooking ? 'â‚¹0 <span class="free-badge-inline">âœ¨ FREE</span>' : `â‚¹${c.ticket_price}`;
  document.getElementById('mc-name').textContent = c.event_name;
  document.getElementById('mc-price').innerHTML = priceDisplay + '<small style="font-size:0.6rem;font-family:\'JetBrains Mono\',monospace;color:var(--muted)">/seat</small>';
  document.getElementById('mc-price').className = 'movie-price' + (S.isFreeBooking ? ' free-price' : '');

  // Free ribbon
  const ribbon = document.getElementById('freeRibbon');
  ribbon.classList.toggle('hidden', !S.isFreeBooking);
  _t('ribbonCount', freeLeft);

  // Sold out / disabled check
  const soldout  = remaining <= 0;
  const disabled = !c.booking_enabled;
  _show('soldoutBanner',  soldout && !disabled);
  _show('disabledBanner', disabled);
  _show('bookingForm',    !soldout && !disabled);

  // UPI
  _t('upiIdTxt', c.upi_id);

  updatePriceSummary();
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  POLLING â€” refresh settings + status changes
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function initPolling() {
  setInterval(async () => {
    await syncSettings();
    if (!S.tickets.length) return;
    try {
      const ids = S.tickets.map(t=>t.id).join(',');
      const fresh = await DB.get('tickets', `id=in.(${ids})&select=id,status`);
      fresh.forEach(row => {
        const prev = S.knownSt[row.id];
        if (prev && prev !== row.status) {
          const tk = S.tickets.find(t=>t.id===row.id);
          pushNotif(`ğŸ« Ticket ${tk?.ticket_id||row.id} â†’ ${row.status.toUpperCase()}`);
          const i = S.tickets.findIndex(t=>t.id===row.id);
          if (i>=0) S.tickets[i].status = row.status;
          saveTix();
          if (_el('view-tickets').classList.contains('active')) renderTcards();
        }
        S.knownSt[row.id] = row.status;
      });
    } catch(e){}
  }, 8000);
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  VIEWS
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function gotoView(name, btn) {
  $$('.view').forEach(v=>v.classList.remove('active'));
  _el(`view-${name}`).classList.add('active');
  $$('.nav-pill').forEach(b=>b.classList.remove('active'));
  if (btn) btn.classList.add('active');
  else document.querySelector(`[data-v="${name}"]`)?.classList.add('active');
  if (name === 'tickets') loadMyTickets();
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  WIZARD
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function goStep(n) {
  // Validate step 2
  if (n === 3 && !validateStep2()) return;

  $$('.step-pane').forEach(p=>p.classList.remove('active'));
  _el(`step${n}`).classList.add('active');

  for (let i=1; i<=4; i++) {
    const ws = _el(`ws${i}`);
    ws.classList.remove('active','done');
    if (i < n) ws.classList.add('done');
    else if (i === n) ws.classList.add('active');
  }
  S.step = n;

  // Step 3 setup
  if (n === 3) setupPaymentStep();
  window.scrollTo({top:0, behavior:'smooth'});
}

function setupPaymentStep() {
  const total = calcTotal();
  S.isFreeBooking = total === 0;

  _show('freePaySection', S.isFreeBooking);
  _show('paidPaySection', !S.isFreeBooking);

  _el('upiAmt').textContent = 'â‚¹' + total;
  _el('upiAmt').className = 'upi-amt' + (S.isFreeBooking ? ' free' : '');

  // UTR label hint
  _el('utrLabel').textContent = S.isFreeBooking
    ? 'Reference Number (optional)'
    : 'UTR / Transaction ID *';

  _el('inUTR').placeholder = S.isFreeBooking
    ? 'Optional reference (skip if none)'
    : '12-digit transaction reference';
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  QTY + PRICE
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function chgQty(d) {
  const max = Math.min(S.cfg.total_tickets - S.cfg.tickets_sold, 10);
  S.qty = Math.max(1, Math.min(max, S.qty + d));
  _t('qtyNum', S.qty);
  updatePriceSummary();
}

function calcTotal() {
  const c = S.cfg;
  const freeLeft = Math.max(0, c.free_tickets - c.free_used);
  const freeApplied = Math.min(S.qty, freeLeft);
  const paidQty = S.qty - freeApplied;
  return paidQty * c.ticket_price;
}

function updatePriceSummary() {
  const c = S.cfg;
  const freeLeft = Math.max(0, c.free_tickets - c.free_used);
  const freeApplied = Math.min(S.qty, freeLeft);
  const paidQty = S.qty - freeApplied;
  const total = paidQty * c.ticket_price;
  const isFree = total === 0;

  _t('priceQty', S.qty);
  _t('pricePer', isFree ? 'FREE âœ¨' : `â‚¹${c.ticket_price}`);
  _el('pricePer').style.color = isFree ? 'var(--green)' : '';

  if (freeApplied > 0) {
    _show('freeRow', true);
    _t('freeSeats', `${freeApplied} seat${freeApplied>1?'s':''} FREE`);
  } else {
    _show('freeRow', false);
  }

  _el('priceTotal').textContent = isFree ? 'â‚¹0 â€” FREE! âœ¨' : `â‚¹${total}`;
  _el('priceTotal').style.color = isFree ? 'var(--green)' : '';
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  FORM VALIDATION
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function vf(id) {
  const el = _el(id), v = el.value.trim();
  let ok = true;
  if (id==='inName')  ok = v.length >= 2;
  if (id==='inEmail') ok = /^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(v);
  if (id==='inPhone') ok = /^[6-9]\d{9}$/.test(v);
  if (id==='inUTR')   ok = v.length >= 6 || (S.isFreeBooking && v.length === 0);
  el.classList.toggle('err', !ok && v.length>0);
  const errMap = {inName:'eN',inEmail:'eE',inPhone:'eP',inUTR:'eU'};
  if (errMap[id]) _el(errMap[id]).classList.toggle('show', !ok && v.length>0);
  return ok;
}
function validateStep2() {
  const ok = ['inName','inEmail','inPhone'].map(f=>vf(f)).every(Boolean);
  if (!ok) toast('Please fill all required fields correctly', 'err');
  return ok;
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  PAYMENT HELPERS
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function copyUPI() {
  navigator.clipboard.writeText(S.cfg.upi_id).then(()=>toast('UPI ID copied! ğŸ“‹'));
}
function openUPI(app) {
  const amt = calcTotal();
  window.location.href = `upi://pay?pa=${S.cfg.upi_id}&pn=Reel+to+Deal&am=${amt}&cu=INR`;
}
function onFileSelect(e) {
  const f = e.target.files[0]; if(!f) return;
  const r = new FileReader();
  r.onload = ev => {
    const img = _el('previewImg');
    img.src=ev.target.result; img.style.display='block';
    toast('Screenshot uploaded âœ“','ok');
  };
  r.readAsDataURL(f);
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  SUBMIT BOOKING
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
async function submitBooking() {
  const total    = calcTotal();
  const isFree   = total === 0;
  const utrVal   = _el('inUTR').value.trim();

  if (!isFree) {
    if (!vf('inUTR')) { toast('Please enter UTR / Transaction ID','err'); return; }
    const ss = _el('ssFile').files[0];
    if (!ss) { toast('Please upload payment screenshot','err'); return; }
  }

  const btn  = _el('submitBtn');
  const btxt = _el('submitTxt');
  btn.disabled = true;
  btxt.innerHTML = '<span class="spin"></span> Processingâ€¦';

  try {
    // Re-fetch fresh settings to check availability + free count
    const [fresh] = await DB.get('settings','id=eq.1&select=*');
    if (!fresh.booking_enabled) { toast('Bookings are currently paused','err'); return; }

    const remaining = fresh.total_tickets - fresh.tickets_sold;
    if (remaining < S.qty) { toast('Not enough tickets remaining!','err'); return; }

    const freeLeft   = Math.max(0, fresh.free_tickets - fresh.free_used);
    const freeApplied = Math.min(S.qty, freeLeft);
    const finalAmount = (S.qty - freeApplied) * fresh.ticket_price;
    const thisIsFree  = finalAmount === 0;

    const ticketId = 'RTD-' + Date.now().toString(36).toUpperCase() + '-' + Math.random().toString(36).substr(2,4).toUpperCase();
    const name   = _el('inName').value.trim();
    const email  = _el('inEmail').value.trim();
    const phone  = _el('inPhone').value.trim();
    const college= _el('inCollege').value.trim();

    // Duplicate UTR check (only for paid)
    if (!thisIsFree && utrVal) {
      const dup = await DB.get('tickets',`utr=eq.${utrVal}&select=id`);
      if (dup.length) { toast('This UTR is already registered!','err'); return; }
    }

    // Upload screenshot (paid only)
    let ssURL = '';
    if (!thisIsFree) {
      const ssFile = _el('ssFile').files[0];
      try {
        const ext = (ssFile.name.split('.').pop()||'jpg').toLowerCase();
        ssURL = await DB.upload('screenshots', `${ticketId}.${ext}`, ssFile);
      } catch(e) { console.warn('Screenshot upload skipped:', e); }
    }

    // Insert ticket
    const [ticket] = await DB.post('tickets', {
      ticket_id:     ticketId,
      user_name:     name,
      email, phone, college,
      movie_name:    fresh.event_name,
      quantity:      S.qty,
      amount:        finalAmount,
      is_free:       thisIsFree,
      utr:           utrVal || null,
      screenshot_url:ssURL || null,
      status:        'pending',
      event_date:    fresh.event_date,
      venue:         fresh.venue,
    });

    // Atomically update counters in settings
    await DB.patch('settings','id=eq.1',{
      tickets_sold: fresh.tickets_sold + S.qty,
      free_used:    fresh.free_used + freeApplied,
    });

    // Update local state + cache
    S.cfg.tickets_sold = fresh.tickets_sold + S.qty;
    S.cfg.free_used    = fresh.free_used + freeApplied;
    S.booking = ticket;
    S.knownSt[ticket.id] = 'pending';
    S.tickets.unshift(ticket);
    saveTix();

    renderTicket(ticket, thisIsFree);
    goStep(4);
    applySettings(); // refresh banner counters

    toast('Booking submitted! ğŸ‰', 'ok');
    pushNotif(`ğŸ« Booking ${ticketId} submitted â€” awaiting verification`);

  } catch(e) {
    console.error(e);
    toast('Booking failed: ' + (e.message||'Unknown error'), 'err');
  } finally {
    btn.disabled = false;
    btxt.textContent = 'Submit Booking';
  }
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  RENDER TICKET
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function renderTicket(t, isFree) {
  _t('tktBrand',  `ğŸ¬ ${t.movie_name} Â· MBA Fest 2025`);
  _t('tktMovie',  t.movie_name);
  _t('tktDate',   t.event_date||S.cfg.event_date);
  _t('tktVenue',  t.venue||S.cfg.venue);
  _t('tktQty',    t.quantity + ' Seat(s)');
  _t('tktName',   t.user_name);
  _t('tktEmail',  t.email);
  _el('tktAmt').textContent = isFree ? 'FREE âœ¨' : 'â‚¹'+t.amount;
  _el('tktAmt').className = 't-dv ' + (isFree ? 'green' : 'gold');
  _el('tktType').innerHTML = isFree
    ? '<span class="sbadge sb-free"><div class="sd"></div>Free Ticket</span>'
    : '<span style="color:var(--gold2);font-family:JetBrains Mono,monospace;font-size:0.68rem">Paid</span>';
  _t('tktTid', t.ticket_id);
  setBadge('tktStatusBadge', t.status||'pending');

  // Free stamp
  _el('tktFreeStamp').style.display = isFree ? 'block' : 'none';

  // Step4 sub
  _el('s4sub').textContent = isFree
    ? 'Free ticket confirmed Â· pending seat assignment'
    : 'Payment under review by admin';

  // QR
  _el('qrDiv').innerHTML = '';
  try {
    new QRCode(_el('qrDiv'), {
      text: `RTD|${t.ticket_id}|${t.user_name}|${isFree?'FREE':t.amount}`,
      width: 88, height: 88,
      colorDark: '#d4a843', colorLight: '#ffffff'
    });
  } catch(e) {}
}

function setBadge(id, status) {
  const el = _el(id); if(!el) return;
  const m = {
    pending:  ['sb-pending','â³ Pending'],
    review:   ['sb-review','ğŸ” Review'],
    approved: ['sb-approved','âœ… Approved'],
    rejected: ['sb-rejected','âŒ Rejected'],
  };
  const [cls, lbl] = m[status]||m.pending;
  el.className = 'sbadge '+cls;
  el.innerHTML = `<div class="sd"></div>${lbl}`;
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  MY TICKETS
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
async function loadMyTickets() {
  _show('skelCards', true);
  _el('tcardList').style.display = 'none';

  try {
    const all = await DB.get('tickets','order=created_at.desc&select=*');
    // Merge db data with local cache (prefer DB)
    const dbIds = new Set(all.map(t=>t.id));
    const localOnly = S.tickets.filter(t=>!dbIds.has(t.id));
    S.tickets = [...all, ...localOnly];
    S.tickets.forEach(t=>{ S.knownSt[t.id]=t.status; });
    saveTix(); setSync(true);
  } catch(e) { setSync(false); }

  renderTcards();
  _show('skelCards', false);
  _el('tcardList').style.display = 'block';
}

function renderTcards() {
  const el = _el('tcardList');
  if (!S.tickets.length) {
    el.innerHTML = `<div class="empty"><div class="empty-ico">ğŸŸ</div><div class="empty-ttl">No tickets yet</div><div class="empty-sub">Book your first ticket above</div></div>`;
    return;
  }
  el.innerHTML = S.tickets.map(t => {
    const isFree = t.is_free;
    return `
    <div class="tcard" id="tc-${t.id}">
      ${isFree ? '<div class="tcard-free-strip"></div>' : ''}
      <div class="tcard-head">
        <div>
          <div class="tcard-movie">${t.movie_name||'Reel to Deal'} ${isFree?'<span class="sbadge sb-free" style="font-size:0.55rem;padding:2px 7px"><div class="sd"></div>FREE</span>':''}</div>
          <div class="tcard-id">${t.ticket_id}</div>
        </div>
        <div>${makeBadge(t.status)}</div>
      </div>
      <div class="tcard-body">
        <div class="tc-col"><div class="tc-col-lbl">Amount</div><div class="tc-col-val ${isFree?'green':''}">${isFree?'FREE âœ¨':'â‚¹'+t.amount}</div></div>
        <div class="tc-col"><div class="tc-col-lbl">Seats</div><div class="tc-col-val">${t.quantity}</div></div>
        <div class="tc-col"><div class="tc-col-lbl">Booked</div><div class="tc-col-val">${fmtDate(t.created_at)}</div></div>
        <div class="tc-col"><div class="tc-col-lbl">Status</div><div class="tc-col-val">${t.status?.toUpperCase()||'â€”'}</div></div>
      </div>
      <div class="tcard-foot">
        <button class="btn btn-ghost btn-sm" onclick="viewTix('${t.id}')">View</button>
        <button class="btn btn-ghost btn-sm" onclick="dlTixPDF('${t.id}')">â¬‡ PDF</button>
        <button class="btn btn-red btn-sm" onclick="delTix('${t.id}')">Delete</button>
      </div>
    </div>`;
  }).join('');
}

function makeBadge(status) {
  const m = {pending:['sb-pending','â³ Pending'],review:['sb-review','ğŸ” Review'],approved:['sb-approved','âœ… Approved'],rejected:['sb-rejected','âŒ Rejected']};
  const [cls,lbl] = m[status]||m.pending;
  return `<div class="sbadge ${cls}"><div class="sd"></div>${lbl}</div>`;
}

async function delTix(id) {
  if (!confirm('Delete this ticket?')) return;
  try {
    await DB.del('tickets',`id=eq.${id}`);
    S.tickets = S.tickets.filter(t=>t.id!==id);
    saveTix(); renderTcards();
    toast('Ticket deleted','err');
  } catch(e) { toast('Delete failed','err'); }
}
function viewTix(id) {
  const t = S.tickets.find(t=>t.id===id);
  if (!t) return;
  S.booking = t;
  renderTicket(t, t.is_free);
  gotoView('book', null);
  goStep(4);
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  PDF DOWNLOAD
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function dlPDF() { if (S.booking) genPDF(S.booking); else toast('No ticket to download','err'); }
function dlTixPDF(id) { const t=S.tickets.find(t=>t.id===id); if(t) genPDF(t); }

function genPDF(t) {
  try {
    const { jsPDF } = window.jspdf;
    const doc = new jsPDF({orientation:'landscape',unit:'mm',format:[90,58]});
    const isFree = t.is_free;

    doc.setFillColor(14, 11, 5); doc.rect(0,0,90,58,'F');
    // Gold stripe
    doc.setFillColor(212,168,67); doc.rect(0,0,90,9,'F');
    doc.setTextColor(14,11,5); doc.setFont('helvetica','bold'); doc.setFontSize(7);
    doc.text((t.movie_name||'REEL TO DEAL').toUpperCase()+' Â· MBA FEST 2025', 45,6,{align:'center'});

    if (isFree) {
      doc.setFillColor(61,214,140); doc.rect(68,0,22,9,'F');
      doc.setTextColor(14,11,5); doc.setFont('helvetica','bold'); doc.setFontSize(5.5);
      doc.text('FREE TICKET', 79,5.8,{align:'center'});
    }

    doc.setTextColor(240,234,216); doc.setFont('helvetica','bold'); doc.setFontSize(11);
    doc.text(t.movie_name||'Reel to Deal', 5,17);
    doc.setFont('helvetica','normal'); doc.setFontSize(6); doc.setTextColor(138,126,106);
    doc.text(`${t.event_date||''} Â· ${t.venue||''}`, 5,22);

    const rows=[
      ['Ticket ID', t.ticket_id],['Name',t.user_name],['Email',t.email],
      ['Seats',String(t.quantity)],['Amount',isFree?'FREE âœ¨':'â‚¹'+t.amount],
      ['Type',isFree?'Free Ticket':'Paid'],['Status',(t.status||'pending').toUpperCase()]
    ];
    let y=28;
    doc.setFontSize(6.5);
    rows.forEach(([k,v])=>{
      doc.setTextColor(138,126,106); doc.text(k+':',5,y);
      doc.setTextColor(isFree&&k==='Amount'?[61,214,140]:[240,234,216]); doc.text(String(v),32,y);
      y+=4;
    });

    doc.setFillColor(30,22,8); doc.rect(0,51,90,7,'F');
    doc.setTextColor(212,168,67); doc.setFontSize(4.5);
    doc.text('Valid only with admin approval Â· Reel to Deal MBA Fest 2025', 45,55,{align:'center'});

    doc.save(`RTD-${t.ticket_id}.pdf`);
    toast('PDF downloaded â¬‡','ok');
  } catch(e) { toast('PDF error','err'); }
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  BOOK ANOTHER
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function bookAnother() {
  S.qty=1; S.booking=null;
  ['inName','inEmail','inPhone','inCollege','inUTR'].forEach(id=>_el(id).value='');
  _el('ssFile').value=''; _el('previewImg').style.display='none';
  _t('qtyNum','1');
  goStep(1);
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  NOTIFICATIONS
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function pushNotif(msg) {
  S.notifs.unshift({msg,t:new Date()});
  renderNotifs();
  const b=_el('bellBadge');
  b.style.display='flex'; b.textContent=S.notifs.length;
}
function toggleNotif() { _el('notifPanel').classList.toggle('open'); }
function clearNotifs() { S.notifs=[]; renderNotifs(); _el('bellBadge').style.display='none'; _el('notifPanel').classList.remove('open'); }
function renderNotifs() {
  const el=_el('notifList');
  el.innerHTML = S.notifs.length ? S.notifs.map(n=>`
    <div class="notif-item"><div class="ni-msg">${n.msg}</div><div class="ni-time">${n.t.toLocaleTimeString()}</div></div>
  `).join('') : '<div class="notif-empty">No notifications</div>';
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  TOAST
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function toast(msg, type='') {
  const el=document.createElement('div');
  el.className='toast'+(type?' '+type:'');
  const icons={ok:'âœ“ ',err:'âœ• ',warn:'âš  '};
  el.textContent=(icons[type]||'')+msg;
  _el('toastWrap').appendChild(el);
  setTimeout(()=>{ el.classList.add('bye'); setTimeout(()=>el.remove(),250); },3400);
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  UTILS
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function setSync(ok) {
  _el('syncDot').className='sync-dot'+(ok?'':' off');
  _t('syncLbl', ok?'Live':'Offline');
}
function saveTix() { try{localStorage.setItem('rtd2_tickets',JSON.stringify(S.tickets));}catch(e){} }
function fmtDate(iso) { try{return new Date(iso).toLocaleDateString('en-IN',{day:'2-digit',month:'short',year:'numeric'});}catch(e){return iso||'â€”';} }
function animNum(id, n) {
  const el=_el(id); if(!el) return;
  const old=parseInt(el.textContent)||0;
  if (old===n) return;
  el.textContent=n;
  el.classList.add('flash');
  setTimeout(()=>el.classList.remove('flash'),600);
}
const _el = id => document.getElementById(id);
const _t  = (id,v) => { const e=_el(id); if(e) e.textContent=v; };
const _show = (id,v) => { const e=_el(id); if(e) e.style.display=v?'':'none'; };
const $$   = s => document.querySelectorAll(s);

// Close notif on outside click
document.addEventListener('click', e => {
  const p=_el('notifPanel');
  if(p && !p.contains(e.target) && !_el('bellBtn').contains(e.target)) p.classList.remove('open');
});
</script>
</body>
</html>
