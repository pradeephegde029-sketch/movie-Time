<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1.0,maximum-scale=1.0,user-scalable=no">
<title>Reel to Deal â€” Book Tickets</title>
<link rel="preconnect" href="https://fonts.googleapis.com">
<link href="https://fonts.googleapis.com/css2?family=Playfair+Display:ital,wght@0,400;0,700;0,900;1,400;1,700&family=JetBrains+Mono:wght@300;400;500;700&family=Outfit:wght@300;400;500;600&display=swap" rel="stylesheet">
<script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
<style>
/* â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
   DESIGN TOKENS
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â” */
:root{
  --bg:#06050a; --bg2:#0c0b12; --sur:#12101a; --sur2:#181524; --sur3:#201d2e; --sur4:#2a263c;
  --border:rgba(255,255,255,0.07); --border2:rgba(255,255,255,0.12);
  --gold:#d4a843; --gold2:#f0c760; --gold3:#fbe49a;
  --goldglow:rgba(212,168,67,0.18); --goldrim:rgba(212,168,67,0.35);
  --text:#ede8d8; --muted:#8a7e6a; --faint:#3d3830;
  --green:#3dd68c; --greendim:rgba(61,214,140,0.12);
  --red:#f05252; --reddim:rgba(240,82,82,0.12);
  --yellow:#fbbf24; --yellowdim:rgba(251,191,36,0.12);
  --r8:8px; --r12:12px; --r16:16px; --r24:24px;
  --ease:cubic-bezier(0.16,1,0.3,1);
  --tap:44px;
}
*,*::before,*::after{margin:0;padding:0;box-sizing:border-box;}
html{-webkit-tap-highlight-color:transparent;}
body{background:var(--bg);color:var(--text);font-family:'Outfit',sans-serif;min-height:100vh;overflow-x:hidden;}
@media(max-width:640px){.orb{display:none;}}
.orb{position:fixed;border-radius:50%;filter:blur(90px);pointer-events:none;z-index:0;}
.orb1{width:500px;height:500px;background:rgba(212,168,67,0.055);top:-120px;left:50%;transform:translateX(-50%);}
.orb2{width:280px;height:280px;background:rgba(96,165,250,0.035);bottom:5%;right:-80px;}

/* â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
   SPLASH SCREEN
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â” */
#splash{
  position:fixed;inset:0;z-index:9999;background:var(--bg);
  display:flex;flex-direction:column;align-items:center;justify-content:center;gap:18px;
  transition:opacity 0.7s var(--ease),visibility 0.7s;
}
#splash.gone{opacity:0;visibility:hidden;pointer-events:none;}
.sp-reel{font-size:3rem;animation:reelSpin 1.3s ease-in-out infinite;}
@keyframes reelSpin{0%,100%{transform:rotate(0)}50%{transform:rotate(180deg)}}
.sp-title{font-family:'Playfair Display',serif;font-weight:900;font-size:clamp(2rem,8vw,3.5rem);
  background:linear-gradient(135deg,var(--gold3),var(--gold2),var(--gold));
  -webkit-background-clip:text;-webkit-text-fill-color:transparent;background-clip:text;}
.sp-title em{font-style:italic;}
.sp-sub{font-family:'JetBrains Mono',monospace;font-size:0.58rem;letter-spacing:0.28em;color:var(--muted);text-transform:uppercase;}
.sp-bar{width:180px;height:2px;background:var(--sur3);border-radius:2px;overflow:hidden;}
.sp-fill{height:100%;background:linear-gradient(90deg,var(--gold),var(--gold2));animation:spFill 1.6s var(--ease) forwards;}
@keyframes spFill{from{width:0}to{width:100%}}

/* â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
   LANDING PAGE â€” full-screen cinematic intro
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â” */
#landing{
  position:relative;min-height:100vh;display:flex;flex-direction:column;
  overflow:hidden;transition:opacity 0.5s var(--ease);
}
#landing.gone{opacity:0;pointer-events:none;}
.ld-bg{
  position:absolute;inset:0;background-size:cover;background-position:center;
  filter:blur(26px) brightness(0.22) saturate(1.5);transform:scale(1.1);
  transition:background-image 0.8s;
}
.ld-vignette{position:absolute;inset:0;background:radial-gradient(ellipse 100% 70% at 50% 40%,rgba(6,5,10,0.25) 0%,rgba(6,5,10,0.88) 75%,rgba(6,5,10,0.98) 100%);}
.ld-top-line{position:absolute;top:0;left:0;right:0;height:2px;background:linear-gradient(90deg,transparent,var(--gold) 30%,var(--gold2) 50%,var(--gold) 70%,transparent);z-index:3;}
/* top-bar on landing */
.ld-nav{position:relative;z-index:4;display:flex;align-items:center;justify-content:space-between;padding:16px 20px;}
.ld-nav-brand{font-family:'Playfair Display',serif;font-size:1.05rem;font-weight:700;color:var(--gold2);}
.ld-nav-brand em{font-style:italic;color:var(--gold3);}
.ld-nav-right{display:flex;gap:8px;}
.ld-admin-link{background:rgba(255,255,255,0.06);border:1px solid rgba(255,255,255,0.1);color:rgba(255,255,255,0.5);
  font-family:'JetBrains Mono',monospace;font-size:0.52rem;letter-spacing:0.08em;text-transform:uppercase;
  padding:0 12px;border-radius:100px;text-decoration:none;display:flex;align-items:center;min-height:32px;
  transition:all 0.2s;}
.ld-admin-link:hover{border-color:var(--goldrim);color:var(--gold2);}
/* centre content */
.ld-body{
  position:relative;z-index:2;flex:1;display:flex;flex-direction:column;
  align-items:center;justify-content:center;padding:0 20px 24px;text-align:center;
}
.ld-eyebrow{
  font-family:'JetBrains Mono',monospace;font-size:0.56rem;letter-spacing:0.26em;
  text-transform:uppercase;color:var(--gold);margin-bottom:20px;
  display:inline-flex;align-items:center;gap:10px;
}
.ld-eyebrow::before,.ld-eyebrow::after{content:'';width:24px;height:1px;background:linear-gradient(90deg,transparent,var(--gold));}
.ld-eyebrow::after{background:linear-gradient(90deg,var(--gold),transparent);}
.ld-poster{
  width:96px;height:136px;border-radius:12px;border:2px solid var(--goldrim);
  overflow:hidden;margin:0 auto 22px;
  background:linear-gradient(160deg,#2a1f0e,#0e0c08);
  display:flex;align-items:center;justify-content:center;font-size:2.4rem;
  box-shadow:0 20px 50px rgba(0,0,0,0.75),0 0 0 1px rgba(212,168,67,0.1);
  flex-shrink:0;
}
.ld-poster img{width:100%;height:100%;object-fit:cover;display:block;}
.ld-title{
  font-family:'Playfair Display',serif;font-weight:900;
  font-size:clamp(2.6rem,10vw,5.2rem);line-height:0.95;
  background:linear-gradient(135deg,var(--gold3) 0%,var(--gold2) 40%,var(--gold) 70%,#b07f20 100%);
  -webkit-background-clip:text;-webkit-text-fill-color:transparent;background-clip:text;
  margin-bottom:6px;
}
.ld-title em{font-style:italic;}
.ld-tagline{font-family:'JetBrains Mono',monospace;font-size:0.6rem;letter-spacing:0.2em;text-transform:uppercase;color:var(--muted);margin-bottom:28px;}
/* info chips row */
.ld-chips{display:flex;gap:8px;justify-content:center;flex-wrap:wrap;margin-bottom:30px;}
.ld-chip{
  background:rgba(255,255,255,0.06);border:1px solid rgba(255,255,255,0.12);
  border-radius:100px;padding:6px 14px;font-family:'JetBrains Mono',monospace;
  font-size:0.54rem;letter-spacing:0.06em;color:rgba(255,255,255,0.6);
}
.ld-chip.gold{background:var(--goldglow);border-color:var(--goldrim);color:var(--gold2);}
.ld-chip.price{background:rgba(212,168,67,0.1);border-color:rgba(212,168,67,0.35);color:var(--gold3);font-size:0.72rem;font-weight:600;padding:7px 18px;}
/* countdown on landing */
.ld-countdown{margin-bottom:32px;}
.ld-cd-lbl{font-family:'JetBrains Mono',monospace;font-size:0.5rem;letter-spacing:0.2em;text-transform:uppercase;color:var(--gold);opacity:0.8;margin-bottom:12px;}
.ld-cd-row{display:flex;align-items:flex-end;justify-content:center;gap:6px;}
.ld-cd-block{display:flex;flex-direction:column;align-items:center;gap:4px;}
.ld-cd-num{
  font-family:'Playfair Display',serif;font-size:clamp(1.8rem,7vw,3rem);font-weight:900;color:#fff;
  background:rgba(255,255,255,0.07);border:1px solid rgba(255,255,255,0.12);
  border-radius:10px;padding:6px 14px;min-width:60px;text-align:center;line-height:1.1;
}
.ld-cd-unit{font-family:'JetBrains Mono',monospace;font-size:0.42rem;letter-spacing:0.14em;text-transform:uppercase;color:var(--muted);}
.ld-cd-sep{font-family:'Playfair Display',serif;font-size:2rem;color:var(--gold);opacity:0.5;padding-bottom:10px;}
/* CTA */
.ld-cta{
  display:inline-flex;align-items:center;gap:10px;
  background:linear-gradient(135deg,var(--gold),var(--gold2));
  color:var(--bg);font-family:'JetBrains Mono',monospace;font-size:0.76rem;
  letter-spacing:0.14em;text-transform:uppercase;font-weight:700;
  padding:0 40px;border-radius:100px;border:none;cursor:pointer;
  min-height:54px;box-shadow:0 8px 30px rgba(212,168,67,0.38);
  transition:all 0.25s var(--ease);
}
.ld-cta:hover{transform:translateY(-2px);box-shadow:0 14px 38px rgba(212,168,67,0.48);}
.ld-cta-arrow{font-size:1.1rem;transition:transform 0.2s;}
.ld-cta:hover .ld-cta-arrow{transform:translateX(4px);}
.ld-seats-note{
  margin-top:16px;font-family:'JetBrains Mono',monospace;font-size:0.54rem;
  color:rgba(255,255,255,0.35);display:flex;align-items:center;gap:6px;
}
.ld-seats-n{color:var(--gold2);font-weight:600;}

/* â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
   APP SHELL
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â” */
#app{display:none;}
#app.show{display:block;}

/* top bar */
#topbar{
  position:sticky;top:0;z-index:200;display:flex;align-items:center;
  justify-content:space-between;padding:0 16px;height:52px;
  background:rgba(6,5,10,0.95);backdrop-filter:blur(20px);-webkit-backdrop-filter:blur(20px);
  border-bottom:1px solid var(--border);
}
.tb-brand{font-family:'Playfair Display',serif;font-size:0.98rem;font-weight:700;color:var(--gold2);cursor:pointer;white-space:nowrap;}
.tb-brand em{font-style:italic;color:var(--gold3);}
.tb-right{display:flex;align-items:center;gap:4px;}

/* nav pills */
.nav-pill{
  background:none;border:none;cursor:pointer;
  font-family:'JetBrains Mono',monospace;font-size:0.58rem;letter-spacing:0.05em;text-transform:uppercase;
  color:var(--muted);padding:0 9px;border-radius:100px;transition:all 0.2s;
  min-height:var(--tap);display:flex;align-items:center;
}
.nav-pill.active{background:var(--goldglow);color:var(--gold2);border:1px solid var(--goldrim);}
.nav-pill:hover:not(.active){color:var(--gold2);}

/* sync chip â€” 3 states */
.sync-chip{
  display:flex;align-items:center;gap:5px;padding:0 8px;border-radius:100px;
  border:1px solid var(--border);min-height:28px;
  font-family:'JetBrains Mono',monospace;font-size:0.5rem;transition:all 0.3s;
}
.sync-chip.live{border-color:rgba(61,214,140,0.3);background:rgba(61,214,140,0.06);color:var(--green);}
.sync-chip.connecting{border-color:rgba(251,191,36,0.25);background:rgba(251,191,36,0.05);color:var(--yellow);}
.sync-chip.offline{border-color:rgba(240,82,82,0.3);background:rgba(240,82,82,0.06);color:var(--red);}
.sync-dot{width:6px;height:6px;border-radius:50%;flex-shrink:0;}
.sync-chip.live .sync-dot{background:var(--green);animation:sdPulse 2.4s infinite;}
.sync-chip.connecting .sync-dot{background:var(--yellow);}
.sync-chip.offline .sync-dot{background:var(--red);}
@keyframes sdPulse{0%,100%{box-shadow:0 0 0 0 rgba(61,214,140,0.5)}50%{box-shadow:0 0 0 5px rgba(61,214,140,0)}}

.bell-btn{position:relative;background:none;border:none;cursor:pointer;font-size:1rem;color:var(--muted);padding:0 6px;min-height:var(--tap);display:flex;align-items:center;transition:color 0.2s;}
.bell-btn:hover{color:var(--gold2);}
.bell-badge{position:absolute;top:6px;right:2px;background:var(--red);color:#fff;font-family:'JetBrains Mono',monospace;font-size:0.4rem;font-weight:700;width:12px;height:12px;border-radius:50%;display:none;align-items:center;justify-content:center;}

/* ticker */
.ticker-wrap{overflow:hidden;background:rgba(212,168,67,0.025);border-bottom:1px solid var(--border);height:26px;display:flex;align-items:center;}
.ticker-inner{display:flex;white-space:nowrap;animation:tickScroll 32s linear infinite;}
@keyframes tickScroll{from{transform:translateX(0)}to{transform:translateX(-50%)}}
.tick-item{font-family:'JetBrains Mono',monospace;font-size:0.52rem;letter-spacing:0.1em;color:var(--gold);padding:0 24px;display:inline-flex;align-items:center;gap:6px;}
.tick-dot{width:3px;height:3px;border-radius:50%;background:var(--gold);opacity:0.4;}

/* â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
   MOVIE HERO STRIP (inside app, below topbar)
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â” */
.hero-strip{position:relative;overflow:hidden;height:130px;border-bottom:1px solid var(--border);}
.hs-bg{position:absolute;inset:0;background-size:cover;background-position:center 30%;filter:blur(20px) brightness(0.22) saturate(1.5);transform:scale(1.08);}
.hs-grad{position:absolute;inset:0;background:linear-gradient(to right,rgba(6,5,10,0.1) 0%,rgba(6,5,10,0.7) 100%);}
.hs-grad2{position:absolute;bottom:0;left:0;right:0;height:55%;background:linear-gradient(to bottom,transparent,rgba(6,5,10,0.92));}
.hs-rim{position:absolute;top:0;left:0;right:0;height:1px;background:linear-gradient(90deg,transparent,var(--goldrim) 40%,var(--goldrim) 60%,transparent);}
.hs-content{position:relative;z-index:2;display:flex;align-items:center;gap:14px;padding:0 16px;height:100%;}
.hs-poster{width:52px;height:74px;border-radius:8px;border:1.5px solid var(--goldrim);overflow:hidden;flex-shrink:0;background:linear-gradient(160deg,#2a1f0e,#0e0c08);display:flex;align-items:center;justify-content:center;font-size:1.5rem;box-shadow:0 4px 16px rgba(0,0,0,0.6);}
.hs-poster img{width:100%;height:100%;object-fit:cover;display:block;}
.hs-info{flex:1;min-width:0;}
.hs-title{font-family:'Playfair Display',serif;font-size:1.15rem;font-weight:900;color:#fff;text-shadow:0 2px 8px rgba(0,0,0,0.8);margin-bottom:5px;white-space:nowrap;overflow:hidden;text-overflow:ellipsis;}
.hs-title em{font-style:italic;color:var(--gold3);}
.hs-tags{display:flex;gap:5px;margin-bottom:5px;flex-wrap:wrap;}
.hs-tag{background:rgba(255,255,255,0.09);border:1px solid rgba(255,255,255,0.12);border-radius:4px;padding:2px 7px;font-family:'JetBrains Mono',monospace;font-size:0.47rem;color:rgba(255,255,255,0.6);}
.hs-tag.gprice{background:var(--goldglow);border-color:var(--goldrim);color:var(--gold2);}
.hs-venue{font-family:'JetBrains Mono',monospace;font-size:0.48rem;color:rgba(255,255,255,0.38);}
/* stats right side */
.hs-stats{display:flex;gap:6px;flex-shrink:0;}
.hs-stat{background:rgba(0,0,0,0.4);border:1px solid rgba(255,255,255,0.08);border-radius:8px;padding:6px 10px;display:flex;flex-direction:column;align-items:center;gap:2px;min-width:48px;}
.hs-sval{font-family:'Playfair Display',serif;font-size:0.95rem;font-weight:700;color:var(--text);line-height:1;}
.hs-sval.hi{color:var(--green);}
.hs-sval.flash{color:var(--gold2)!important;}
.hs-slbl{font-family:'JetBrains Mono',monospace;font-size:0.38rem;letter-spacing:0.06em;text-transform:uppercase;color:var(--muted);}
@media(max-width:380px){.hs-stats{display:none;}}

/* â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
   WRAP + VIEWS
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â” */
.wrap{max-width:640px;margin:0 auto;padding:0 16px 100px;position:relative;z-index:1;}
.view{display:none;}
.view.active{display:block;animation:viewIn 0.3s var(--ease) both;}
@keyframes viewIn{from{opacity:0;transform:translateY(10px)}to{opacity:1;transform:none}}

/* â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
   BOOKING VIEW â€” compact event countdown
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â” */
.view-head{padding:20px 0 14px;}
.view-head-title{font-family:'Playfair Display',serif;font-size:1.3rem;font-weight:700;margin-bottom:3px;}
.view-head-sub{font-family:'JetBrains Mono',monospace;font-size:0.54rem;color:var(--muted);}

/* compact countdown inside booking */
.mini-cd{
  display:flex;align-items:center;gap:12px;
  background:var(--sur2);border:1px solid var(--border2);border-radius:var(--r12);
  padding:11px 16px;margin-bottom:16px;
}
.mini-cd-lbl{font-family:'JetBrains Mono',monospace;font-size:0.48rem;letter-spacing:0.16em;text-transform:uppercase;color:var(--gold);flex-shrink:0;}
.mini-cd-row{display:flex;align-items:center;gap:4px;}
.mini-cd-block{display:flex;flex-direction:column;align-items:center;gap:1px;}
.mini-cd-num{font-family:'Playfair Display',serif;font-size:1.15rem;font-weight:900;color:var(--text);background:var(--sur3);border-radius:5px;padding:2px 8px;min-width:36px;text-align:center;line-height:1.25;}
.mini-cd-unit{font-family:'JetBrains Mono',monospace;font-size:0.36rem;letter-spacing:0.1em;text-transform:uppercase;color:var(--faint);}
.mini-cd-sep{font-family:'Playfair Display',serif;font-size:1.1rem;color:var(--gold);opacity:0.5;padding-bottom:8px;}

/* â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
   WIZARD STEPS
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â” */
.wizard{display:flex;align-items:center;margin:0 0 22px;font-family:'JetBrains Mono',monospace;}
.ws{flex:1;display:flex;flex-direction:column;align-items:center;gap:5px;position:relative;}
.ws::after{content:'';position:absolute;top:12px;left:50%;width:100%;height:1.5px;background:var(--sur4);transition:background 0.35s;}
.ws:last-child::after{display:none;}
.ws.done::after{background:var(--gold);}
.ws-num{width:24px;height:24px;border-radius:50%;border:1.5px solid var(--sur4);background:var(--sur);display:flex;align-items:center;justify-content:center;font-size:0.58rem;color:var(--muted);position:relative;z-index:1;transition:all 0.3s;}
.ws.active .ws-num{border-color:var(--gold2);background:var(--goldglow);color:var(--gold2);box-shadow:0 0 10px var(--goldglow);}
.ws.done .ws-num{border-color:var(--gold);background:var(--gold);color:var(--bg);}
.ws.done .ws-num::after{content:'âœ“';}
.ws.done .ws-num span{display:none;}
.ws-lbl{color:var(--faint);text-align:center;text-transform:uppercase;white-space:nowrap;font-size:0.48rem;font-family:'JetBrains Mono',monospace;}
.ws.active .ws-lbl{color:var(--gold2);}
.ws.done .ws-lbl{color:var(--muted);}
.step-pane{display:none;}
.step-pane.active{display:block;animation:stepIn 0.28s var(--ease) both;}
@keyframes stepIn{from{opacity:0;transform:translateX(12px)}to{opacity:1;transform:none}}

/* â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
   FREE TICKET GATE â€” gated ribbon at top of step 1
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â” */
.free-gate{
  background:rgba(61,214,140,0.05);border:1px solid rgba(61,214,140,0.2);
  border-radius:var(--r12);padding:14px;margin-bottom:16px;
  display:none;animation:viewIn 0.25s var(--ease);
}
.free-gate.show{display:block;}
.fg-head{display:flex;align-items:flex-start;gap:10px;margin-bottom:12px;}
.fg-icon{font-size:1.2rem;flex-shrink:0;margin-top:1px;}
.fg-text h4{font-size:0.88rem;font-weight:600;color:var(--green);margin-bottom:3px;}
.fg-text p{font-family:'JetBrains Mono',monospace;font-size:0.54rem;color:var(--muted);line-height:1.55;}
.fg-input-row{display:flex;gap:8px;}
.fg-inp{
  flex:1;padding:10px 12px;background:rgba(0,0,0,0.3);
  border:1px solid rgba(61,214,140,0.25);border-radius:var(--r8);
  color:var(--text);font-family:'JetBrains Mono',monospace;font-size:0.76rem;
  letter-spacing:0.14em;outline:none;transition:all 0.2s;min-height:var(--tap);text-transform:uppercase;
}
.fg-inp:focus{border-color:rgba(61,214,140,0.55);box-shadow:0 0 0 3px rgba(61,214,140,0.1);}
.fg-inp.ok{border-color:var(--green);background:rgba(61,214,140,0.07);}
.fg-inp.bad{border-color:var(--red);animation:shake 0.32s ease;}
@keyframes shake{0%,100%{transform:translateX(0)}25%{transform:translateX(-5px)}75%{transform:translateX(5px)}}
.fg-btn{
  padding:0 14px;background:rgba(61,214,140,0.12);border:1px solid rgba(61,214,140,0.28);
  color:var(--green);font-family:'JetBrains Mono',monospace;font-size:0.58rem;letter-spacing:0.08em;
  border-radius:var(--r8);cursor:pointer;transition:all 0.2s;min-height:var(--tap);white-space:nowrap;
}
.fg-btn:hover{background:rgba(61,214,140,0.22);}
.fg-msg{font-family:'JetBrains Mono',monospace;font-size:0.54rem;margin-top:8px;padding:6px 10px;border-radius:6px;display:none;}
.fg-msg.ok{display:block;background:rgba(61,214,140,0.1);color:var(--green);}
.fg-msg.err{display:block;background:rgba(240,82,82,0.1);color:var(--red);}

/* â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
   SECTION LABEL
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â” */
.sec-lbl{
  font-family:'JetBrains Mono',monospace;font-size:0.52rem;letter-spacing:0.2em;
  text-transform:uppercase;color:var(--gold);padding-left:10px;
  border-left:2px solid var(--gold);margin-bottom:12px;
}

/* â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
   MOVIE CARD (step 1) â€” PRICE BUG FIX
   Price ALWAYS shows real ticket price by default.
   Changes to FREE only after S.freeUnlocked === true
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â” */
.movie-card{
  background:linear-gradient(140deg,var(--sur2),var(--sur));
  border:1.5px solid var(--gold2);border-radius:var(--r16);padding:18px;
  display:flex;gap:14px;align-items:flex-start;margin-bottom:16px;
  position:relative;overflow:hidden;box-shadow:0 0 0 2px var(--goldglow);
}
.movie-card::before{content:'';position:absolute;top:0;left:0;right:0;height:1px;background:linear-gradient(90deg,transparent,var(--goldrim),transparent);}
.mc-thumb{width:58px;height:82px;border-radius:8px;background:linear-gradient(160deg,#2a1f0e,#140f06);border:1px solid var(--goldrim);display:flex;align-items:center;justify-content:center;font-size:1.6rem;flex-shrink:0;overflow:hidden;}
.mc-thumb img{width:100%;height:100%;object-fit:cover;display:block;}
.mc-info{flex:1;min-width:0;}
.mc-name{font-family:'Playfair Display',serif;font-size:1.02rem;font-weight:700;margin-bottom:7px;color:var(--text);}
.mc-name em{font-style:italic;color:var(--gold3);}
.mc-tags{display:flex;flex-wrap:wrap;gap:5px;margin-bottom:10px;}
.mc-tag{background:var(--sur3);border-radius:4px;padding:2px 7px;font-family:'JetBrains Mono',monospace;font-size:0.52rem;color:var(--muted);}
/* price row */
.mc-price-row{display:flex;align-items:baseline;gap:6px;}
.mc-price{font-family:'Playfair Display',serif;font-size:1.3rem;font-weight:700;color:var(--gold2);transition:color 0.3s,opacity 0.3s;}
.mc-price.is-free{color:var(--green);}
.mc-price-sub{font-family:'JetBrains Mono',monospace;font-size:0.52rem;color:var(--muted);}
/* selected badge */
.mc-sel{position:absolute;top:10px;right:10px;background:linear-gradient(135deg,var(--gold),var(--gold2));color:var(--bg);font-family:'JetBrains Mono',monospace;font-size:0.48rem;letter-spacing:0.08em;padding:3px 8px;border-radius:4px;font-weight:700;}

/* â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
   QUANTITY + PRICE BOX
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â” */
.qty-row{
  display:flex;align-items:center;justify-content:space-between;
  background:var(--sur2);border:1px solid var(--border2);border-radius:var(--r12);
  padding:14px 16px;margin-bottom:12px;
}
.qty-lbl{font-size:0.9rem;font-weight:500;}
.qty-hint{font-family:'JetBrains Mono',monospace;font-size:0.5rem;color:var(--muted);margin-top:2px;}
.qty-ctrl{display:flex;align-items:center;gap:0;}
.qty-btn{
  width:36px;height:36px;border-radius:8px;border:1.5px solid var(--border2);
  background:var(--sur3);color:var(--text);font-size:1.1rem;cursor:pointer;
  transition:all 0.18s;display:flex;align-items:center;justify-content:center;
}
.qty-btn:hover:not(:disabled){background:var(--sur4);border-color:var(--goldrim);}
.qty-btn:disabled{opacity:0.3;cursor:default;}
.qty-num{font-family:'Playfair Display',serif;font-size:1.5rem;font-weight:700;min-width:44px;text-align:center;}

.price-box{background:var(--sur2);border:1px solid var(--border);border-radius:var(--r12);overflow:hidden;margin-bottom:16px;}
.pr-row{display:flex;justify-content:space-between;align-items:center;padding:10px 16px;border-bottom:1px solid var(--border);}
.pr-row:last-child{border:none;}
.pr-row.total-row{background:rgba(212,168,67,0.04);border-top:1px solid rgba(212,168,67,0.15);}
.pr-k{font-family:'JetBrains Mono',monospace;font-size:0.56rem;color:var(--muted);}
.pr-v{font-family:'JetBrains Mono',monospace;font-size:0.7rem;color:var(--text);}
.pr-v.free{color:var(--green);}
.pr-row.total-row .pr-k{font-size:0.6rem;color:var(--text);font-weight:600;}
.pr-row.total-row .pr-v{font-family:'Playfair Display',serif;font-size:1.1rem;color:var(--gold2);font-weight:700;}
.pr-row.total-row .pr-v.free{color:var(--green);}

/* â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
   CARDS + FORMS
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â” */
.card{background:var(--sur);border:1px solid var(--border);border-radius:var(--r16);padding:20px;margin-bottom:14px;position:relative;overflow:hidden;}
.card::before{content:'';position:absolute;top:0;left:0;right:0;height:1px;background:linear-gradient(90deg,transparent,var(--goldrim),transparent);opacity:0;transition:opacity 0.3s;}
.card:hover::before{opacity:1;}
.card-title{font-family:'Playfair Display',serif;font-size:0.95rem;font-weight:700;margin-bottom:16px;display:flex;align-items:center;gap:8px;}

.fg{margin-bottom:14px;}
.fl{display:block;font-family:'JetBrains Mono',monospace;font-size:0.52rem;letter-spacing:0.12em;text-transform:uppercase;color:var(--muted);margin-bottom:6px;}
.fi{width:100%;padding:11px 14px;background:var(--sur2);border:1.5px solid var(--border);border-radius:var(--r8);color:var(--text);font-family:'Outfit',sans-serif;font-size:0.92rem;outline:none;transition:all 0.2s;min-height:var(--tap);}
.fi:focus{border-color:var(--goldrim);box-shadow:0 0 0 3px var(--goldglow);}
.fi.err{border-color:rgba(240,82,82,0.5);}
.ferr{font-family:'JetBrains Mono',monospace;font-size:0.52rem;color:var(--red);margin-top:5px;display:none;}
.ferr.show{display:block;}
.fg-2col{display:grid;grid-template-columns:1fr 1fr;gap:10px;}
@media(max-width:380px){.fg-2col{grid-template-columns:1fr;}}

/* â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
   PAYMENT STEP
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â” */
.pay-card{background:var(--sur2);border:1px solid var(--border);border-radius:var(--r16);overflow:hidden;margin-bottom:14px;}
.pay-card-head{padding:11px 16px;background:rgba(212,168,67,0.05);border-bottom:1px solid var(--border);font-family:'JetBrains Mono',monospace;font-size:0.56rem;letter-spacing:0.1em;text-transform:uppercase;color:var(--gold);}
.pay-card-body{padding:18px 16px;}
.pay-amount-badge{text-align:center;margin-bottom:18px;}
.pay-amount{font-family:'Playfair Display',serif;font-size:2.4rem;font-weight:900;color:var(--gold2);}
.pay-amount.free{color:var(--green);}
.pay-amount-lbl{font-family:'JetBrains Mono',monospace;font-size:0.52rem;color:var(--muted);margin-top:2px;}
.qr-wrap{display:flex;flex-direction:column;align-items:center;gap:8px;margin-bottom:16px;}
.qr-box{width:104px;height:104px;background:#fff;border-radius:10px;padding:7px;display:flex;align-items:center;justify-content:center;}
.qr-lbl{font-family:'JetBrains Mono',monospace;font-size:0.5rem;color:var(--muted);}
.upi-id-row{display:flex;gap:8px;margin-bottom:14px;}
.upi-id-val{flex:1;padding:10px 12px;background:var(--sur3);border:1px solid var(--border);border-radius:8px;font-family:'JetBrains Mono',monospace;font-size:0.7rem;color:var(--gold2);}
.upi-copy-btn{padding:0 12px;background:var(--sur3);border:1px solid var(--border2);border-radius:8px;color:var(--muted);font-family:'JetBrains Mono',monospace;font-size:0.58rem;cursor:pointer;transition:all 0.2s;min-height:var(--tap);white-space:nowrap;}
.upi-copy-btn:hover{border-color:var(--goldrim);color:var(--gold2);}
.upi-open-btn{width:100%;padding:12px;background:linear-gradient(135deg,#5b21b6,#4338ca);border:none;border-radius:10px;color:#fff;font-family:'JetBrains Mono',monospace;font-size:0.64rem;letter-spacing:0.08em;text-transform:uppercase;cursor:pointer;transition:opacity 0.2s;min-height:var(--tap);margin-bottom:12px;}
.upi-open-btn:hover{opacity:0.88;}
.pay-steps{font-family:'JetBrains Mono',monospace;font-size:0.54rem;color:var(--muted);line-height:1.9;background:var(--sur3);border-radius:8px;padding:10px 14px;}
/* free ticket notice */
.free-notice-box{background:var(--greendim);border:1px solid rgba(61,214,140,0.2);border-radius:var(--r16);padding:20px;text-align:center;margin-bottom:14px;}
.free-notice-icon{font-size:2rem;margin-bottom:8px;}
.free-notice-title{font-family:'Playfair Display',serif;font-size:1.1rem;color:var(--green);font-weight:700;margin-bottom:4px;}
.free-notice-sub{font-family:'JetBrains Mono',monospace;font-size:0.56rem;color:var(--muted);}

/* â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
   UPLOAD
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â” */
.upload-zone{border:2px dashed var(--border2);border-radius:var(--r12);padding:20px;text-align:center;cursor:pointer;position:relative;transition:all 0.2s;margin-bottom:8px;}
.upload-zone:hover,.upload-zone.drag{border-color:var(--goldrim);background:var(--goldglow);}
.upload-zone input[type=file]{position:absolute;inset:0;opacity:0;cursor:pointer;width:100%;height:100%;}
.upload-icon{font-size:1.5rem;margin-bottom:6px;}
.upload-title{font-size:0.88rem;font-weight:500;margin-bottom:3px;}
.upload-sub{font-family:'JetBrains Mono',monospace;font-size:0.52rem;color:var(--muted);}
.upload-ok{font-family:'JetBrains Mono',monospace;font-size:0.56rem;color:var(--green);display:none;}
.upload-ok.show{display:block;}
#previewImg{display:none;width:100%;max-height:180px;object-fit:contain;border-radius:8px;margin-top:10px;}

/* â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
   BUTTONS
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â” */
.btn{display:inline-flex;align-items:center;justify-content:center;gap:6px;padding:0 20px;border-radius:10px;border:none;cursor:pointer;font-family:'JetBrains Mono',monospace;font-size:0.64rem;letter-spacing:0.08em;text-transform:uppercase;transition:all 0.2s;min-height:var(--tap);font-weight:600;}
.btn-gold{background:linear-gradient(135deg,var(--gold),var(--gold2));color:var(--bg);}
.btn-gold:hover{transform:translateY(-1px);box-shadow:0 4px 16px rgba(212,168,67,0.3);}
.btn-gold:disabled{opacity:0.5;transform:none;cursor:default;}
.btn-ghost{background:transparent;border:1.5px solid var(--border2);color:var(--muted);}
.btn-ghost:hover{border-color:var(--goldrim);color:var(--gold2);}
.btn-row{display:flex;gap:8px;}
.btn-row .btn{flex:1;}
.spin{display:inline-block;width:14px;height:14px;border:2px solid rgba(255,255,255,0.25);border-top-color:currentColor;border-radius:50%;animation:spn 0.6s linear infinite;}
@keyframes spn{to{transform:rotate(360deg)}}

/* â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
   BANNERS
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â” */
.info-banner{border-radius:var(--r12);padding:16px 20px;text-align:center;margin-bottom:16px;border:1px solid;}
.info-banner h3{font-family:'Playfair Display',serif;font-size:1.05rem;margin-bottom:4px;}
.info-banner p{font-family:'JetBrains Mono',monospace;font-size:0.54rem;color:var(--muted);}
.bn-red{background:var(--reddim);border-color:rgba(240,82,82,0.2);}
.bn-red h3{color:var(--red);}
.bn-yellow{background:var(--yellowdim);border-color:rgba(251,191,36,0.2);}
.bn-yellow h3{color:var(--yellow);}

/* â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
   TICKET (step 4)
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â” */
.ticket-shell{padding:8px 2px 16px;}
.ticket{background:linear-gradient(145deg,#1a1726,#0f0e1a);border:1px solid var(--goldrim);border-radius:16px;overflow:hidden;position:relative;box-shadow:0 14px 44px rgba(0,0,0,0.6);}
.t-bg{position:absolute;inset:0;background-image:repeating-linear-gradient(45deg,transparent,transparent 18px,rgba(212,168,67,0.02) 18px,rgba(212,168,67,0.02) 19px);pointer-events:none;}
.t-rim{position:absolute;top:0;left:0;right:0;height:2px;background:linear-gradient(90deg,transparent,var(--gold),var(--gold2),var(--gold),transparent);}
.t-free-stamp{position:absolute;top:12px;right:12px;background:linear-gradient(135deg,var(--green),#20c770);color:#fff;font-family:'JetBrains Mono',monospace;font-size:0.52rem;letter-spacing:0.1em;padding:4px 9px;border-radius:5px;font-weight:700;}
.t-head{padding:16px 18px 14px;}
.t-brand{font-family:'JetBrains Mono',monospace;font-size:0.52rem;letter-spacing:0.1em;color:var(--gold);margin-bottom:5px;}
.t-movie{font-family:'Playfair Display',serif;font-size:1.2rem;font-weight:900;color:var(--text);margin-bottom:10px;}
.t-meta{display:flex;gap:16px;flex-wrap:wrap;}
.t-meta-item{display:flex;flex-direction:column;gap:2px;}
.t-mk{font-family:'JetBrains Mono',monospace;font-size:0.44rem;letter-spacing:0.1em;text-transform:uppercase;color:var(--muted);}
.t-mv{font-family:'JetBrains Mono',monospace;font-size:0.63rem;color:var(--text);}
.t-tear{border-top:2px dashed rgba(212,168,67,0.18);margin:0;}
.t-body{padding:14px 18px;display:flex;gap:14px;justify-content:space-between;align-items:flex-start;}
.t-details{flex:1;min-width:0;}
.t-row{display:flex;justify-content:space-between;align-items:center;padding:5px 0;border-bottom:1px solid rgba(255,255,255,0.04);}
.t-row:last-child{border:none;}
.t-dk{font-family:'JetBrains Mono',monospace;font-size:0.52rem;color:var(--muted);}
.t-dv{font-family:'JetBrains Mono',monospace;font-size:0.63rem;color:var(--text);text-align:right;word-break:break-all;max-width:55%;}
.t-dv.gold{color:var(--gold2);}
.t-dv.green{color:var(--green);}
.t-qr-wrap{display:flex;flex-direction:column;align-items:center;gap:4px;flex-shrink:0;}
.t-qr-box{width:88px;height:88px;background:#fff;border-radius:7px;padding:5px;display:flex;align-items:center;justify-content:center;}
.t-qr-lbl{font-family:'JetBrains Mono',monospace;font-size:0.4rem;letter-spacing:0.1em;text-transform:uppercase;color:var(--faint);}
.t-foot{padding:10px 18px;background:rgba(0,0,0,0.2);display:flex;justify-content:space-between;align-items:center;}
.t-tid{font-family:'JetBrains Mono',monospace;font-size:0.56rem;color:var(--gold);letter-spacing:0.06em;}
.sbadge{display:inline-flex;align-items:center;gap:4px;padding:3px 8px;border-radius:100px;font-family:'JetBrains Mono',monospace;font-size:0.5rem;letter-spacing:0.05em;font-weight:600;}
.sb-pending{background:rgba(251,191,36,0.12);color:var(--yellow);border:1px solid rgba(251,191,36,0.25);}
.sb-review{background:rgba(96,165,250,0.12);color:#60a5fa;border:1px solid rgba(96,165,250,0.25);}
.sb-approved{background:rgba(61,214,140,0.12);color:var(--green);border:1px solid rgba(61,214,140,0.28);animation:sbGlow 2s infinite;}
.sb-rejected{background:rgba(240,82,82,0.12);color:var(--red);border:1px solid rgba(240,82,82,0.25);}
.sb-free{background:rgba(61,214,140,0.1);color:var(--green);border:1px solid rgba(61,214,140,0.2);}
@keyframes sbGlow{0%,100%{box-shadow:0 0 4px rgba(61,214,140,0.1)}50%{box-shadow:0 0 14px rgba(61,214,140,0.35)}}
.sd{width:4px;height:4px;border-radius:50%;background:currentColor;flex-shrink:0;}

/* â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
   MY TICKETS
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â” */
.tcard{background:var(--sur);border:1px solid var(--border);border-radius:var(--r16);overflow:hidden;margin-bottom:12px;transition:all 0.2s;position:relative;}
.tcard:hover{border-color:rgba(212,168,67,0.18);transform:translateY(-2px);box-shadow:0 8px 24px rgba(0,0,0,0.4);}
.tcard-head{padding:12px 14px;display:flex;justify-content:space-between;align-items:flex-start;border-bottom:1px solid var(--border);flex-wrap:wrap;gap:5px;}
.tc-movie{font-family:'Playfair Display',serif;font-size:0.88rem;font-weight:700;margin-bottom:2px;}
.tc-id{font-family:'JetBrains Mono',monospace;font-size:0.5rem;color:var(--muted);}
.tcard-body{padding:10px 14px;display:flex;justify-content:space-between;flex-wrap:wrap;gap:8px;border-bottom:1px solid var(--border);}
.tc-col{display:flex;flex-direction:column;gap:2px;}
.tc-col-lbl{font-family:'JetBrains Mono',monospace;font-size:0.44rem;letter-spacing:0.1em;text-transform:uppercase;color:var(--faint);}
.tc-col-val{font-family:'JetBrains Mono',monospace;font-size:0.64rem;color:var(--text);}
.tc-col-val.green{color:var(--green);}
.tcard-foot{padding:8px 14px;background:rgba(0,0,0,0.15);display:flex;gap:6px;align-items:center;flex-wrap:wrap;}
.tcard-strip{position:absolute;left:0;top:0;bottom:0;width:3px;}
.ts-pending{background:var(--yellow);}
.ts-approved{background:var(--green);}
.ts-rejected{background:var(--red);}
.ts-free{background:linear-gradient(to bottom,var(--green),#20c770);}
.tab-row{display:flex;gap:3px;margin-bottom:14px;background:var(--sur2);border-radius:var(--r12);padding:4px;}
.tab-btn{flex:1;border:none;background:none;color:var(--muted);font-family:'JetBrains Mono',monospace;font-size:0.52rem;letter-spacing:0.04em;text-transform:uppercase;cursor:pointer;border-radius:8px;transition:all 0.2s;min-height:var(--tap);}
.tab-btn.active{background:var(--goldglow);color:var(--gold2);border:1px solid var(--goldrim);}

/* â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
   FAQ
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â” */
.faq-item{border:1px solid var(--border);border-radius:var(--r12);overflow:hidden;margin-bottom:8px;}
.faq-q{padding:14px 16px;cursor:pointer;font-weight:500;display:flex;justify-content:space-between;align-items:center;background:var(--sur2);transition:background 0.2s;min-height:var(--tap);font-size:0.88rem;}
.faq-q:hover{background:var(--sur3);}
.faq-arr{font-size:0.58rem;color:var(--gold);transition:transform 0.3s;flex-shrink:0;}
.faq-item.open .faq-arr{transform:rotate(180deg);}
.faq-a{display:none;padding:14px 16px;font-size:0.83rem;color:var(--muted);line-height:1.7;background:var(--sur);}
.faq-item.open .faq-a{display:block;}

/* â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
   TOAST / NOTIF / LOADING
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â” */
#toastWrap{position:fixed;bottom:20px;left:50%;transform:translateX(-50%);z-index:9000;display:flex;flex-direction:column;gap:6px;align-items:center;pointer-events:none;width:calc(100vw - 32px);max-width:380px;}
.toast{background:var(--sur2);border:1px solid var(--border2);border-radius:100px;padding:9px 18px;font-family:'JetBrains Mono',monospace;font-size:0.6rem;letter-spacing:0.04em;color:var(--text);pointer-events:auto;animation:toastUp 0.24s var(--ease) both;box-shadow:0 6px 22px rgba(0,0,0,0.5);max-width:100%;overflow:hidden;text-overflow:ellipsis;white-space:nowrap;}
.toast.ok{border-color:rgba(61,214,140,0.3);background:rgba(61,214,140,0.09);color:var(--green);}
.toast.err{border-color:rgba(240,82,82,0.3);background:rgba(240,82,82,0.09);color:var(--red);}
.toast.warn{border-color:rgba(251,191,36,0.3);background:rgba(251,191,36,0.08);color:var(--yellow);}
@keyframes toastUp{from{opacity:0;transform:translateY(10px) scale(0.94)}to{opacity:1;transform:none}}
.toast.bye{animation:toastBye 0.2s ease forwards;}
@keyframes toastBye{to{opacity:0;transform:scale(0.88)}}
#notifPanel{position:fixed;top:58px;right:12px;z-index:500;width:280px;max-width:calc(100vw - 24px);background:var(--sur);border:1px solid var(--border2);border-radius:var(--r16);overflow:hidden;box-shadow:0 16px 48px rgba(0,0,0,0.65);display:none;}
#notifPanel.open{display:block;animation:notifIn 0.18s var(--ease);}
@keyframes notifIn{from{opacity:0;transform:translateY(-6px) scale(0.97)}to{opacity:1;transform:none}}
.notif-head{padding:10px 14px;background:rgba(0,0,0,0.2);font-family:'JetBrains Mono',monospace;font-size:0.54rem;letter-spacing:0.12em;text-transform:uppercase;color:var(--gold);display:flex;justify-content:space-between;align-items:center;}
.notif-clear{background:none;border:none;color:var(--muted);cursor:pointer;font-size:0.58rem;font-family:'JetBrains Mono',monospace;padding:4px;}
.notif-item{padding:9px 14px;border-bottom:1px solid var(--border);font-size:0.76rem;}
.ni-time{font-family:'JetBrains Mono',monospace;font-size:0.47rem;color:var(--muted);margin-top:2px;}
.notif-empty{padding:20px;text-align:center;font-family:'JetBrains Mono',monospace;font-size:0.58rem;color:var(--faint);}
.loading-ov{position:fixed;inset:0;z-index:9990;background:rgba(6,5,10,0.72);display:none;align-items:center;justify-content:center;}
.loading-ov.show{display:flex;}
.loading-box{background:var(--sur);border:1px solid var(--border2);border-radius:var(--r12);padding:24px 32px;display:flex;flex-direction:column;align-items:center;gap:12px;}
.loading-box .spin{width:26px;height:26px;border-width:3px;color:var(--gold);}
.loading-txt{font-family:'JetBrains Mono',monospace;font-size:0.62rem;letter-spacing:0.1em;color:var(--muted);text-transform:uppercase;}
.skel{background:linear-gradient(90deg,var(--sur2) 25%,var(--sur3) 50%,var(--sur2) 75%);background-size:400% 100%;animation:skelAnim 1.4s infinite;border-radius:6px;}
@keyframes skelAnim{from{background-position:100% 0}to{background-position:-100% 0}}
.skel-card{height:108px;border-radius:var(--r16);margin-bottom:12px;}
.empty-state{text-align:center;padding:44px 20px;}
.empty-ico{font-size:2.4rem;margin-bottom:10px;opacity:0.28;}
.empty-ttl{font-family:'Playfair Display',serif;font-size:1rem;color:var(--muted);margin-bottom:5px;}
.empty-sub{font-family:'JetBrains Mono',monospace;font-size:0.52rem;color:var(--faint);}
.share-row{display:flex;gap:6px;justify-content:center;flex-wrap:wrap;margin-top:10px;}
.share-btn{background:var(--sur2);border:1px solid var(--border2);border-radius:8px;padding:0 12px;font-family:'JetBrains Mono',monospace;font-size:0.52rem;letter-spacing:0.06em;text-transform:uppercase;color:var(--muted);cursor:pointer;transition:all 0.2s;display:flex;align-items:center;gap:4px;min-height:var(--tap);}
.share-btn:hover{border-color:var(--goldrim);color:var(--gold2);}
.confetti-piece{position:fixed;width:8px;height:8px;border-radius:2px;top:-10px;animation:confFall linear forwards;pointer-events:none;z-index:9998;}
@keyframes confFall{to{transform:translateY(105vh) rotate(720deg);opacity:0;}}
</style>
</head>
<body>
<div class="orb orb1"></div>
<div class="orb orb2"></div>

<!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
     SPLASH
 â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
<div id="splash">
  <div class="sp-reel">ğŸ¬</div>
  <div class="sp-title">Reel <em>to</em> Deal</div>
  <div class="sp-sub">Premium Cinema Experience</div>
  <div class="sp-bar"><div class="sp-fill"></div></div>
</div>

<!-- LOADING OVERLAY -->
<div class="loading-ov" id="loadingOv">
  <div class="loading-box">
    <div class="spin"></div>
    <div class="loading-txt" id="loadingTxt">Loadingâ€¦</div>
  </div>
</div>

<!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
     LANDING PAGE
 â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
<div id="landing">
  <div class="ld-bg" id="ldBg"></div>
  <div class="ld-vignette"></div>
  <div class="ld-top-line"></div>

  <nav class="ld-nav">
    <div class="ld-nav-brand">Reel <em>to</em> Deal</div>
    <div class="ld-nav-right">
      <a class="ld-admin-link" href="reel-admin-v5.html" target="_blank">ğŸ” Admin</a>
    </div>
  </nav>

  <div class="ld-body">
    <div class="ld-eyebrow">ğŸ MBA Fest 2025</div>
    <div class="ld-poster" id="ldPoster">ğŸ¬</div>
    <h1 class="ld-title" id="ldTitle">Reel <em>to</em> Deal</h1>
    <p class="ld-tagline" id="ldTagline">Premium Cinema Experience Â· MBA Fest 2025</p>

    <div class="ld-chips">
      <span class="ld-chip" id="ldGenre">Drama Â· Thriller</span>
      <span class="ld-chip" id="ldDur">2h 15m</span>
      <span class="ld-chip gold" id="ldVenueChip">MBA Auditorium</span>
      <span class="ld-chip price" id="ldPrice">â‚¹100 / seat</span>
    </div>

    <!-- BIG COUNTDOWN on landing -->
    <div class="ld-countdown" id="ldCountdownWrap">
      <div class="ld-cd-lbl">ğŸ¬ Event Begins In</div>
      <div class="ld-cd-row">
        <div class="ld-cd-block"><div class="ld-cd-num" id="lcd-d">00</div><div class="ld-cd-unit">Days</div></div>
        <div class="ld-cd-sep">:</div>
        <div class="ld-cd-block"><div class="ld-cd-num" id="lcd-h">00</div><div class="ld-cd-unit">Hours</div></div>
        <div class="ld-cd-sep">:</div>
        <div class="ld-cd-block"><div class="ld-cd-num" id="lcd-m">00</div><div class="ld-cd-unit">Mins</div></div>
        <div class="ld-cd-sep">:</div>
        <div class="ld-cd-block"><div class="ld-cd-num" id="lcd-s">00</div><div class="ld-cd-unit">Secs</div></div>
      </div>
    </div>

    <button class="ld-cta" onclick="enterApp()">
      Book Your Seat <span class="ld-cta-arrow">â†’</span>
    </button>

    <div class="ld-seats-note">
      <span class="ld-seats-n" id="ldSeatsLeft">â€”</span> seats remaining
    </div>
  </div>
</div>

<!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
     MAIN APP
 â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
<div id="app">

<!-- TOPBAR -->
<nav id="topbar">
  <div class="tb-brand" onclick="goLanding()">Reel <em>to</em> Deal</div>
  <div class="tb-right">
    <div class="sync-chip connecting" id="syncChip">
      <div class="sync-dot"></div><span id="syncLbl">Connecting</span>
    </div>
    <button class="nav-pill active" data-v="book" onclick="gotoView('book',this)">Book</button>
    <button class="nav-pill" data-v="tickets" onclick="gotoView('tickets',this)">Tickets</button>
    <button class="nav-pill" data-v="faq" onclick="gotoView('faq',this)">FAQ</button>
    <button class="bell-btn" onclick="toggleNotif()" id="bellBtn">ğŸ””<span class="bell-badge" id="bellBadge"></span></button>
  </div>
</nav>

<!-- TICKER -->
<div class="ticker-wrap">
  <div class="ticker-inner">
    <span class="tick-item"><span class="tick-dot"></span>ğŸ¬ MBA Fest 2025 â€” Book your seats now!</span>
    <span class="tick-item"><span class="tick-dot"></span>ğŸ“ MBA Auditorium â€” Premium cinema experience</span>
    <span class="tick-item"><span class="tick-dot"></span>ğŸŸ Limited seats â€” Don't miss out!</span>
    <span class="tick-item"><span class="tick-dot"></span>âœ¨ Free tickets available â€” use your access code</span>
    <span class="tick-item"><span class="tick-dot"></span>ğŸ¬ MBA Fest 2025 â€” Book your seats now!</span>
    <span class="tick-item"><span class="tick-dot"></span>ğŸ“ MBA Auditorium â€” Premium cinema experience</span>
    <span class="tick-item"><span class="tick-dot"></span>ğŸŸ Limited seats â€” Don't miss out!</span>
    <span class="tick-item"><span class="tick-dot"></span>âœ¨ Free tickets available â€” use your access code</span>
  </div>
</div>

<!-- MOVIE HERO STRIP -->
<div class="hero-strip">
  <div class="hs-bg" id="hsBg"></div>
  <div class="hs-grad"></div><div class="hs-grad2"></div><div class="hs-rim"></div>
  <div class="hs-content">
    <div class="hs-poster" id="hsPoster">ğŸ¬</div>
    <div class="hs-info">
      <div class="hs-title" id="hsTitle">Reel <em>to</em> Deal</div>
      <div class="hs-tags">
        <span class="hs-tag" id="hsGenre">Drama Â· Thriller</span>
        <span class="hs-tag" id="hsDur">2h 15m</span>
        <span class="hs-tag gprice" id="hsPrice">â‚¹100/seat</span>
      </div>
      <div class="hs-venue" id="hsVenue">ğŸ“ MBA Auditorium</div>
    </div>
    <div class="hs-stats">
      <div class="hs-stat"><div class="hs-sval" id="hsSold">â€”</div><div class="hs-slbl">Sold</div></div>
      <div class="hs-stat"><div class="hs-sval hi" id="hsFree">â€”</div><div class="hs-slbl">Free Left</div></div>
      <div class="hs-stat"><div class="hs-sval hi" id="hsAppr">â€”</div><div class="hs-slbl">Approved</div></div>
    </div>
  </div>
</div>

<div id="notifPanel">
  <div class="notif-head"><span>Notifications</span><button class="notif-clear" onclick="clearNotifs()">Clear</button></div>
  <div id="notifList"><div class="notif-empty">No notifications yet</div></div>
</div>
<div id="toastWrap"></div>

<div class="wrap">

<!-- â•â• BOOK VIEW â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
<div class="view active" id="view-book">
  <div class="view-head">
    <div class="view-head-title">ğŸŸ Book Tickets</div>
    <div class="view-head-sub">Complete 4 quick steps to reserve your seat</div>
  </div>

  <!-- Mini countdown inside booking -->
  <div class="mini-cd" id="miniCdWrap">
    <div class="mini-cd-lbl">Event In</div>
    <div class="mini-cd-row">
      <div class="mini-cd-block"><div class="mini-cd-num" id="mcd-d">00</div><div class="mini-cd-unit">D</div></div>
      <div class="mini-cd-sep">:</div>
      <div class="mini-cd-block"><div class="mini-cd-num" id="mcd-h">00</div><div class="mini-cd-unit">H</div></div>
      <div class="mini-cd-sep">:</div>
      <div class="mini-cd-block"><div class="mini-cd-num" id="mcd-m">00</div><div class="mini-cd-unit">M</div></div>
      <div class="mini-cd-sep">:</div>
      <div class="mini-cd-block"><div class="mini-cd-num" id="mcd-s">00</div><div class="mini-cd-unit">S</div></div>
    </div>
  </div>

  <div class="info-banner bn-red" id="soldoutBanner" style="display:none"><h3>ğŸŸ Sold Out</h3><p>All seats have been claimed. Check back later.</p></div>
  <div class="info-banner bn-yellow" id="disabledBanner" style="display:none"><h3>â¸ Bookings Paused</h3><p>Admin has temporarily paused ticket sales.</p></div>

  <div id="bookingForm">
    <!-- WIZARD -->
    <div class="wizard">
      <div class="ws active" id="ws1"><div class="ws-num"><span>1</span></div><div class="ws-lbl">Select</div></div>
      <div class="ws" id="ws2"><div class="ws-num"><span>2</span></div><div class="ws-lbl">Details</div></div>
      <div class="ws" id="ws3"><div class="ws-num"><span>3</span></div><div class="ws-lbl">Payment</div></div>
      <div class="ws" id="ws4"><div class="ws-num"><span>4</span></div><div class="ws-lbl">Ticket</div></div>
    </div>

    <!-- â”€â”€â”€ STEP 1: Select â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ -->
    <div class="step-pane active" id="step1">

      <!-- FREE GATE: visible only when free slots exist. Code-gated. -->
      <div class="free-gate" id="freeGate">
        <div class="fg-head">
          <div class="fg-icon" id="fgIcon">ğŸ”</div>
          <div class="fg-text">
            <h4 id="fgTitle">Free Ticket Available</h4>
            <p id="fgSubtitle">Enter your access code to unlock the free rate for this booking.</p>
          </div>
        </div>
        <div class="fg-input-row" id="fgInputRow">
          <input class="fg-inp" id="fgCode" type="text" maxlength="20" placeholder="ACCESS CODE"
            autocomplete="off"
            oninput="this.value=this.value.toUpperCase();resetFg()"
            onkeydown="if(event.key==='Enter')verifyCode()">
          <button class="fg-btn" id="fgVerifyBtn" onclick="verifyCode()">Verify â†’</button>
        </div>
        <div class="fg-msg" id="fgMsg"></div>
      </div>

      <p class="sec-lbl">Now Showing</p>
      <div class="movie-card">
        <div class="mc-thumb" id="mcThumb">ğŸ­</div>
        <div class="mc-info">
          <div class="mc-name" id="mcName">Reel <em>to</em> Deal</div>
          <div class="mc-tags">
            <span class="mc-tag" id="mcGenre">Drama Â· Thriller</span>
            <span class="mc-tag" id="mcDur">2h 15m</span>
          </div>
          <!--
            PRICE FIX: id="mcPrice" starts at real ticket price.
            JS only switches to FREE after S.freeUnlocked===true.
            Previously isFreeAvail ignored freeUnlocked â€” showing â‚¹0 to everyone.
          -->
          <div class="mc-price-row">
            <div class="mc-price" id="mcPrice">â‚¹100</div>
            <div class="mc-price-sub" id="mcPriceSub">/seat</div>
          </div>
        </div>
        <div class="mc-sel">Selected âœ“</div>
      </div>

      <p class="sec-lbl" style="margin-top:14px">Number of seats</p>
      <div class="qty-row">
        <div>
          <div class="qty-lbl">Quantity</div>
          <div class="qty-hint" id="qtyHint">Max 5 per booking</div>
        </div>
        <div class="qty-ctrl">
          <button class="qty-btn" id="qtyMinus" onclick="chgQty(-1)">âˆ’</button>
          <span class="qty-num" id="qtyNum">1</span>
          <button class="qty-btn" id="qtyPlus" onclick="chgQty(1)">+</button>
        </div>
      </div>

      <div class="price-box">
        <div class="pr-row"><span class="pr-k">Price per seat</span><span class="pr-v" id="pricePer">â‚¹100</span></div>
        <div class="pr-row" id="freeRow" style="display:none"><span class="pr-k">âœ¨ Free seats applied</span><span class="pr-v free" id="freeSeats">â€”</span></div>
        <div class="pr-row"><span class="pr-k">Seats selected</span><span class="pr-v" id="priceQty">1</span></div>
        <div class="pr-row"><span class="pr-k">Convenience fee</span><span class="pr-v">â‚¹0</span></div>
        <div class="pr-row total-row"><span class="pr-k">Total Amount</span><span class="pr-v" id="priceTotal">â‚¹100</span></div>
      </div>

      <button class="btn btn-gold" style="width:100%" onclick="goStep(2)">Continue to Details â†’</button>
    </div>

    <!-- â”€â”€â”€ STEP 2: Details â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ -->
    <div class="step-pane" id="step2">
      <div class="card">
        <div class="card-title">ğŸ‘¤ Personal Information</div>
        <div class="fg">
          <label class="fl">Full Name *</label>
          <input class="fi" id="inName" type="text" placeholder="Your full name" autocomplete="name" oninput="vf('inName')">
          <div class="ferr" id="eN">Name must be at least 2 characters</div>
        </div>
        <div class="fg">
          <label class="fl">Email Address *</label>
          <input class="fi" id="inEmail" type="email" placeholder="you@college.edu" autocomplete="email" oninput="vf('inEmail')">
          <div class="ferr" id="eE">Enter a valid email address</div>
        </div>
        <div class="fg">
          <label class="fl">Mobile Number *</label>
          <input class="fi" id="inPhone" type="tel" placeholder="10-digit number" maxlength="10" autocomplete="tel" oninput="vf('inPhone')">
          <div class="ferr" id="eP">Enter a valid 10-digit number</div>
        </div>
        <div class="fg">
          <label class="fl">College / Institution</label>
          <input class="fi" id="inCollege" type="text" placeholder="Your college name" autocomplete="organization">
        </div>
        <div class="fg-2col">
          <div class="fg" id="fgRoll" style="display:none"><label class="fl">Roll Number</label><input class="fi" id="inRoll" type="text" placeholder="e.g. MBA2023001"></div>
          <div class="fg" id="fgDept" style="display:none"><label class="fl">Department</label><input class="fi" id="inDept" type="text" placeholder="e.g. Finance"></div>
        </div>
        <div class="fg-2col">
          <div class="fg" id="fgYear" style="display:none"><label class="fl">Year</label><select class="fi" id="inYear"><option value="">Select</option><option>1st Year</option><option>2nd Year</option><option>3rd Year</option></select></div>
          <div class="fg" id="fgSect" style="display:none"><label class="fl">Section</label><input class="fi" id="inSect" type="text" placeholder="e.g. A"></div>
        </div>
      </div>
      <div class="btn-row">
        <button class="btn btn-ghost" onclick="goStep(1)">â† Back</button>
        <button class="btn btn-gold" onclick="goStep(3)">Continue to Payment â†’</button>
      </div>
    </div>

    <!-- â”€â”€â”€ STEP 3: Payment â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ -->
    <div class="step-pane" id="step3">

      <!-- FREE path -->
      <div id="freePaySection" style="display:none">
        <div class="free-notice-box">
          <div class="free-notice-icon">ğŸ</div>
          <div class="free-notice-title">This is a FREE ticket!</div>
          <div class="free-notice-sub">No payment needed â€” just submit your details to claim your seat.</div>
        </div>
      </div>

      <!-- PAID path -->
      <div id="paidPaySection" style="display:none">
        <div class="pay-card">
          <div class="pay-card-head">ğŸ’³ Pay via UPI</div>
          <div class="pay-card-body">
            <div class="pay-amount-badge">
              <div class="pay-amount" id="upiAmt">â‚¹100</div>
              <div class="pay-amount-lbl">Total amount to pay</div>
            </div>
            <div class="qr-wrap">
              <div class="qr-box"><div id="upiQrDiv"></div></div>
              <div class="qr-lbl">Scan with any UPI app</div>
            </div>
            <div class="upi-id-row">
              <div class="upi-id-val" id="upiIdTxt">â€”</div>
              <button class="upi-copy-btn" onclick="copyUPI()">ğŸ“‹ Copy</button>
            </div>
            <button class="upi-open-btn" onclick="openUPI()">ğŸ“± Open UPI App to Pay</button>
            <div class="pay-steps">
              1 Â· Scan QR or tap "Open UPI App"<br>
              2 Â· Pay exactly <strong id="payStepAmt">â‚¹100</strong><br>
              3 Â· Screenshot your payment confirmation<br>
              4 Â· Upload screenshot &amp; enter UTR below
            </div>
          </div>
        </div>
        <div class="card">
          <div class="card-title">ğŸ“¸ Payment Screenshot <span style="color:var(--red);font-size:0.8rem">*</span></div>
          <div class="upload-zone" id="uploadZone">
            <input type="file" id="ssFile" accept="image/jpeg,image/png,image/webp" onchange="onFileSelect(event)">
            <div class="upload-icon">ğŸ“</div>
            <div class="upload-title">Tap to upload or drop screenshot</div>
            <div class="upload-sub">JPG Â· PNG Â· WEBP Â· Max 5MB</div>
            <img id="previewImg" alt="Preview">
          </div>
          <div class="upload-ok" id="uploadOk">âœ“ Screenshot ready</div>
        </div>
        <div class="card">
          <div class="card-title">ğŸ§¾ Transaction Reference</div>
          <div class="fg">
            <label class="fl">UTR / Transaction ID *</label>
            <input class="fi" id="inUTR" type="text" placeholder="12-digit transaction ID" oninput="vf('inUTR')">
            <div class="ferr" id="eU">Enter a valid UTR (min 6 characters)</div>
          </div>
        </div>
      </div>

      <div class="btn-row">
        <button class="btn btn-ghost" onclick="goStep(2)">â† Back</button>
        <button class="btn btn-gold" id="submitBtn" onclick="submitBooking()"><span id="submitTxt">Submit Booking</span></button>
      </div>
    </div>

    <!-- â”€â”€â”€ STEP 4: Ticket â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ -->
    <div class="step-pane" id="step4">
      <div style="text-align:center;padding:14px 0 18px">
        <div style="font-size:2.4rem;margin-bottom:8px" id="successEmoji">ğŸ‰</div>
        <div style="font-family:'Playfair Display',serif;font-size:1.3rem;font-weight:700;color:var(--gold2);margin-bottom:4px">Booking Submitted!</div>
        <div style="font-family:'JetBrains Mono',monospace;font-size:0.56rem;color:var(--muted)" id="s4sub">Awaiting admin verification</div>
      </div>
      <div class="ticket-shell">
        <div class="ticket" id="tktEl">
          <div class="t-bg"></div>
          <div class="t-rim"></div>
          <div class="t-free-stamp" id="tktFreeStamp" style="display:none">âœ¨ FREE</div>
          <div class="t-head">
            <div class="t-brand" id="tktBrand">ğŸ¬ Reel to Deal Â· MBA Fest 2025</div>
            <div class="t-movie" id="tktMovie">â€”</div>
            <div class="t-meta">
              <div class="t-meta-item"><div class="t-mk">Date</div><div class="t-mv" id="tktDate">â€”</div></div>
              <div class="t-meta-item"><div class="t-mk">Venue</div><div class="t-mv" id="tktVenue">â€”</div></div>
              <div class="t-meta-item"><div class="t-mk">Seats</div><div class="t-mv" id="tktQty">â€”</div></div>
            </div>
          </div>
          <div class="t-tear"></div>
          <div class="t-body">
            <div class="t-details">
              <div class="t-row"><span class="t-dk">Name</span><span class="t-dv" id="tktName">â€”</span></div>
              <div class="t-row"><span class="t-dk">Email</span><span class="t-dv" id="tktEmail">â€”</span></div>
              <div class="t-row"><span class="t-dk">Amount</span><span class="t-dv gold" id="tktAmt">â€”</span></div>
              <div class="t-row"><span class="t-dk">Type</span><span class="t-dv" id="tktType">â€”</span></div>
            </div>
            <div class="t-qr-wrap">
              <div class="t-qr-box"><div id="qrDiv"></div></div>
              <div class="t-qr-lbl">Scan Â· Verify</div>
            </div>
          </div>
          <div class="t-foot">
            <div class="t-tid" id="tktTid">â€”</div>
            <div id="tktStatusBadge" class="sbadge sb-pending"><div class="sd"></div>Pending</div>
          </div>
        </div>
      </div>
      <div class="share-row">
        <button class="share-btn" onclick="shareTicket()">ğŸ“¤ Share</button>
        <button class="share-btn" onclick="copyTicketId()">ğŸ“‹ Copy ID</button>
        <button class="share-btn" onclick="dlPDF()">â¬‡ PDF</button>
      </div>
      <div class="btn-row" style="margin-top:12px">
        <button class="btn btn-ghost" style="flex:1" onclick="gotoView('tickets',null)">ğŸŸ My Tickets</button>
        <button class="btn btn-gold" style="flex:1" onclick="bookAnother()">ï¼‹ Book Another</button>
      </div>
    </div>

  </div><!-- /bookingForm -->
</div><!-- /view-book -->

<!-- â•â• TICKETS VIEW â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
<div class="view" id="view-tickets">
  <div style="padding:22px 0 12px;display:flex;justify-content:space-between;align-items:center;flex-wrap:wrap;gap:10px">
    <div>
      <div style="font-family:'Playfair Display',serif;font-size:1.3rem;font-weight:700;margin-bottom:3px">Your Tickets</div>
      <div style="font-family:'JetBrains Mono',monospace;font-size:0.54rem;color:var(--muted)">Live from database Â· always current</div>
    </div>
    <div style="display:flex;gap:6px">
      <button class="btn btn-ghost" style="font-size:0.56rem;padding:0 12px;min-height:36px" onclick="exportMyCSV()">â¬‡ CSV</button>
      <button class="btn btn-ghost" style="font-size:0.56rem;padding:0 12px;min-height:36px" onclick="loadMyTickets()">âŸ³ Refresh</button>
    </div>
  </div>
  <div class="tab-row">
    <button class="tab-btn active" onclick="filterTix('all',this)">All</button>
    <button class="tab-btn" onclick="filterTix('pending',this)">â³ Pending</button>
    <button class="tab-btn" onclick="filterTix('approved',this)">âœ… Approved</button>
    <button class="tab-btn" onclick="filterTix('rejected',this)">âŒ Rejected</button>
  </div>
  <div id="skelCards"><div class="skel skel-card"></div><div class="skel skel-card"></div></div>
  <div id="tcardList" style="display:none"></div>
</div>

<!-- â•â• FAQ VIEW â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
<div class="view" id="view-faq">
  <div style="padding:22px 0 16px">
    <div style="font-family:'Playfair Display',serif;font-size:1.3rem;font-weight:700;margin-bottom:4px">FAQ</div>
    <div style="font-family:'JetBrains Mono',monospace;font-size:0.54rem;color:var(--muted)">Frequently asked questions</div>
  </div>
  <div class="faq-item" onclick="this.classList.toggle('open')"><div class="faq-q">How do I book a ticket? <span class="faq-arr">â–¼</span></div><div class="faq-a">Select your seats on Step 1, fill in your details on Step 2, pay via UPI on Step 3, upload the payment screenshot, enter the UTR and submit. You'll receive a digital ticket with a QR code instantly.</div></div>
  <div class="faq-item" onclick="this.classList.toggle('open')"><div class="faq-q">How do free tickets work? <span class="faq-arr">â–¼</span></div><div class="faq-a">If free tickets are available you'll see an "Access Code" panel on Step 1. Enter the code given to you by the organisers to unlock the free rate. Your total will drop to â‚¹0 â€” no payment or screenshot needed.</div></div>
  <div class="faq-item" onclick="this.classList.toggle('open')"><div class="faq-q">Why does the price show â‚¹100 even though free tickets exist? <span class="faq-arr">â–¼</span></div><div class="faq-a">Free tickets are access-code controlled. The price shows the regular rate until you verify your code. Once verified, the price drops to FREE automatically.</div></div>
  <div class="faq-item" onclick="this.classList.toggle('open')"><div class="faq-q">Will my booking disappear after refresh? <span class="faq-arr">â–¼</span></div><div class="faq-a">Never. All data is stored permanently in Supabase. Refreshing always reloads your tickets fresh from the database â€” nothing is ever lost.</div></div>
  <div class="faq-item" onclick="this.classList.toggle('open')"><div class="faq-q">When will my ticket be approved? <span class="faq-arr">â–¼</span></div><div class="faq-a">Admin verifies payment and updates the status. The app auto-refreshes every 10 seconds so you'll see changes in real-time under "My Tickets".</div></div>
  <div class="faq-item" onclick="this.classList.toggle('open')"><div class="faq-q">Can I book multiple seats? <span class="faq-arr">â–¼</span></div><div class="faq-a">Yes â€” use the + / âˆ’ buttons on Step 1 to select up to the max allowed per booking (set by admin, usually 5).</div></div>
  <div class="faq-item" onclick="this.classList.toggle('open')"><div class="faq-q">What if my booking is rejected? <span class="faq-arr">â–¼</span></div><div class="faq-a">If the screenshot is unclear or the UTR doesn't match, admin may reject it. You can book again with the correct details.</div></div>
  <div style="margin-top:16px;text-align:center">
    <a href="reel-admin-v5.html" target="_blank" class="btn btn-ghost" style="text-decoration:none;display:inline-flex">ğŸ” Admin Dashboard â†’</a>
  </div>
</div>

</div><!-- /wrap -->
</div><!-- /app -->

<script>
'use strict';
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  SUPABASE
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
const SB_URL='https://yhrfpcwehtqsppoifhog.supabase.co';
const SB_KEY='eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InlocmZwY3dlaHRxc3Bwb2lmaG9nIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NzE1NzQ5MDAsImV4cCI6MjA4NzE1MDkwMH0.Ml1V2zc8j3XCZIuILuapy2Cs4jcBl0i6sHKxFFl6Sqo';
const H={'apikey':SB_KEY,'Authorization':'Bearer '+SB_KEY,'Content-Type':'application/json','Prefer':'return=representation'};
async function sbFetch(url,opts,n=0){
  try{const r=await fetch(url,opts);if(!r.ok){const t=await r.text().catch(()=>'');throw new Error(t||r.status);}return r;}
  catch(e){if(n>=2)throw e;await new Promise(r=>setTimeout(r,500*(n+1)));return sbFetch(url,opts,n+1);}
}
const DB={
  get:(t,q='')=>sbFetch(`${SB_URL}/rest/v1/${t}?${q}`,{headers:H}).then(r=>r.json()),
  post:(t,b)=>sbFetch(`${SB_URL}/rest/v1/${t}`,{method:'POST',headers:H,body:JSON.stringify(b)}).then(r=>r.json()),
  patch:(t,q,b)=>sbFetch(`${SB_URL}/rest/v1/${t}?${q}`,{method:'PATCH',headers:H,body:JSON.stringify(b)}).then(r=>r.json()),
  upload:(bk,path,file)=>sbFetch(`${SB_URL}/storage/v1/object/${bk}/${path}`,{method:'POST',headers:{'apikey':SB_KEY,'Authorization':'Bearer '+SB_KEY,'Content-Type':file.type},body:file}).then(r=>r.json()).then(()=>`${SB_URL}/storage/v1/object/public/${bk}/${path}`)
};

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  STATE
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
const S={
  qty:1,step:1,tixFilter:'all',
  booking:null,notifs:[],knownSt:{},tickets:[],ssFileObj:null,
  submitting:false,pollTimer:null,pollRunning:false,settingsDirty:false,
  // â”€â”€ KEY FLAG â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  // freeUnlocked starts FALSE. Price card always shows real price.
  // Only set to true after user enters correct access code.
  // ALL price calculations check this flag before applying free rate.
  freeUnlocked:false,
  // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  cfg:{
    event_name:'Reel to Deal',ticket_price:100,total_tickets:200,
    free_tickets:50,free_used:0,tickets_sold:0,upi_id:'rtd@upi',
    venue:'MBA Auditorium',event_date:'â€”',event_date_iso:'',
    booking_enabled:true,max_per_user:5,auto_approval:false,
    free_enabled:true,require_roll:false,require_dept:false,
    require_year:false,require_section:false,free_code:'',
    genre:'Drama Â· Thriller',movie_duration:'2h 15m',movie_poster_url:''
  }
};

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  BOOT
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
document.addEventListener('DOMContentLoaded',async()=>{
  setSync('connecting');
  await syncSettings();   // load DB before showing landing
  startCountdowns();
  initPolling();
  setTimeout(()=>_el('splash').classList.add('gone'),1800);
},{once:true});

// â”€â”€â”€ Landing â†” App navigation â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function enterApp(){
  const ld=_el('landing');
  ld.classList.add('gone');
  setTimeout(()=>{ld.style.display='none';_el('app').classList.add('show');},480);
}
function goLanding(){
  const ld=_el('landing');
  ld.style.display='';
  _el('app').classList.remove('show');
  requestAnimationFrame(()=>ld.classList.remove('gone'));
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  SETTINGS SYNC
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
async function syncSettings(){
  try{
    const[rows,appr]=await Promise.all([
      DB.get('settings','id=eq.1&select=*'),
      DB.get('tickets','status=eq.approved&select=id')
    ]);
    if(rows&&rows[0])Object.assign(S.cfg,rows[0]);
    S.cfg._approvedCount=appr.length;
    setSync('live');
  }catch(e){console.warn('syncSettings:',e);setSync('fail');}
  applySettings();
}
function applySettings(){
  if(S.settingsDirty)return;
  S.settingsDirty=true;
  requestAnimationFrame(()=>{S.settingsDirty=false;_doApply();});
}
function _doApply(){
  const c=S.cfg;
  const rawFree=Math.max(0,(c.free_tickets||0)-(c.free_used||0));
  const remaining=Math.max(0,(c.total_tickets||200)-(c.tickets_sold||0));

  // â”€â”€ Poster image â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  const url=c.movie_poster_url||'';
  ['hsBg','ldBg'].forEach(id=>{
    const el=_el(id);if(el)el.style.backgroundImage=url?`url(${JSON.stringify(url)})`:'';
  });
  ['hsPoster','ldPoster'].forEach(id=>{
    const el=_el(id);if(el)el.innerHTML=url?`<img src="${url}" alt="poster" loading="lazy">`:'ğŸ¬';
  });
  _el('mcThumb').innerHTML=url?`<img src="${url}" alt="poster">`:'ğŸ­';

  // â”€â”€ Hero strip â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  _t('hsTitle',c.event_name||'Reel to Deal');
  _t('hsGenre',c.genre||'Drama Â· Thriller');
  _t('hsDur',  c.movie_duration||'2h 15m');
  _t('hsVenue','ğŸ“ '+(c.venue||'MBA Auditorium')+' Â· '+(c.event_date||''));
  // Strip price: shows FREE only when unlocked
  const stripFree=rawFree>0&&c.free_enabled!==false&&S.freeUnlocked;
  const stripPriceEl=_el('hsPrice');
  if(stripPriceEl){
    stripPriceEl.textContent=stripFree?'âœ¨ FREE':('â‚¹'+(c.ticket_price||100)+'/seat');
    stripPriceEl.className='hs-tag gprice'+(stripFree?' is-free':'');
    if(stripFree)stripPriceEl.style.color='var(--green)';
    else stripPriceEl.style.color='';
  }
  animNum('hsSold',c.tickets_sold||0);
  animNum('hsFree',rawFree);
  animNum('hsAppr',c._approvedCount||0);

  // â”€â”€ Landing page â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  _t('ldTitle',  c.event_name||'Reel to Deal');
  _t('ldGenre',  c.genre||'Drama Â· Thriller');
  _t('ldDur',    c.movie_duration||'2h 15m');
  _t('ldVenueChip',c.venue||'MBA Auditorium');
  // Landing price ALWAYS shows real price (no confusing â‚¹0 before gate)
  _el('ldPrice').textContent='â‚¹'+(c.ticket_price||100)+' / seat';
  _el('ldSeatsLeft').textContent=remaining;

  // â”€â”€ Movie card price â€”â€”â€” THE CORE FIX â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  // isFreeApplied checks BOTH free_enabled AND S.freeUnlocked.
  // Previously this was ignored, making everyone see â‚¹0.
  const isFreeApplied=c.free_enabled!==false&&S.freeUnlocked&&rawFree>0;
  const mcPriceEl=_el('mcPrice'),mcSubEl=_el('mcPriceSub');
  if(isFreeApplied){
    mcPriceEl.textContent='FREE âœ¨';
    mcPriceEl.className='mc-price is-free';
    if(mcSubEl)mcSubEl.textContent='no charge';
  }else{
    mcPriceEl.textContent='â‚¹'+(c.ticket_price||100);
    mcPriceEl.className='mc-price';
    if(mcSubEl)mcSubEl.textContent='/seat';
  }
  _t('mcName',c.event_name||'Reel to Deal');
  _t('mcGenre',c.genre||'Drama Â· Thriller');
  _t('mcDur',c.movie_duration||'2h 15m');

  // â”€â”€ Free gate visibility â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  const hasFreeSlots=c.free_enabled!==false&&rawFree>0;
  const fgEl=_el('freeGate');
  if(hasFreeSlots){
    fgEl.classList.add('show');
    const hasCode=(c.free_code||'').trim().length>0;
    if(S.freeUnlocked){
      _el('fgIcon').textContent='âœ…';
      _el('fgTitle').textContent='Free Ticket Unlocked!';
      _el('fgSubtitle').textContent=`${rawFree} free seat(s) applied to your order.`;
      _el('fgInputRow').style.display='none';
    }else if(!hasCode){
      // No code set â€” one-tap claim
      _el('fgIcon').textContent='âœ¨';
      _el('fgTitle').textContent='Free Tickets Available!';
      _el('fgSubtitle').textContent=`${rawFree} free seat(s) remaining â€” tap Claim to unlock the free rate.`;
      _el('fgCode').style.display='none';
      _el('fgVerifyBtn').textContent='Claim Free â†’';
      _el('fgInputRow').style.display='flex';
    }else{
      _el('fgIcon').textContent='ğŸ”';
      _el('fgTitle').textContent='Free Ticket â€” Access Code Required';
      _el('fgSubtitle').textContent=`${rawFree} free seat(s) remaining Â· Enter your access code below.`;
      _el('fgCode').style.display='';
      _el('fgVerifyBtn').textContent='Verify â†’';
      _el('fgInputRow').style.display='flex';
    }
  }else{
    fgEl.classList.remove('show');
  }

  // â”€â”€ Booking form state â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  const soldout=remaining<=0,disabled=!c.booking_enabled;
  _show('soldoutBanner',soldout&&!disabled);
  _show('disabledBanner',disabled);
  _show('bookingForm',!soldout&&!disabled);
  _t('qtyHint',`Max ${c.max_per_user||5} per booking`);
  _show('fgRoll',c.require_roll);_show('fgDept',c.require_dept);
  _show('fgYear',c.require_year);_show('fgSect',c.require_section);

  updatePriceSummary();
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  COUNTDOWNS â€” landing (big) + booking (mini), same timer
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
let _cdTimer=null;
function startCountdowns(){
  if(_cdTimer)clearInterval(_cdTimer);
  const run=()=>{
    const raw=S.cfg.event_date_iso||'';
    let d;
    try{d=new Date(raw);if(isNaN(d.getTime()))throw 0;}
    catch{
      _el('ldCountdownWrap').style.display='none';
      _el('miniCdWrap').style.display='none';
      return;
    }
    const diff=d-Date.now();
    if(diff<=0){
      _el('ldCountdownWrap').style.display='none';
      _el('miniCdWrap').style.display='none';
      clearInterval(_cdTimer);return;
    }
    const dd=Math.floor(diff/86400000),
          hh=Math.floor((diff%86400000)/3600000),
          mm=Math.floor((diff%3600000)/60000),
          ss=Math.floor((diff%60000)/1000);
    // Landing (big)
    _t('lcd-d',pad(dd));_t('lcd-h',pad(hh));_t('lcd-m',pad(mm));_t('lcd-s',pad(ss));
    // Booking (mini)
    _t('mcd-d',pad(dd));_t('mcd-h',pad(hh));_t('mcd-m',pad(mm));_t('mcd-s',pad(ss));
    _el('ldCountdownWrap').style.display='';
    _el('miniCdWrap').style.display='';
  };
  run();_cdTimer=setInterval(run,1000);
}
const pad=n=>String(n).padStart(2,'0');

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  POLLING
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
const _sf={n:0};
function initPolling(){
  if(S.pollTimer)clearInterval(S.pollTimer);
  S.pollTimer=setInterval(async()=>{
    if(S.pollRunning)return;S.pollRunning=true;
    try{
      const[rows,appr]=await Promise.all([
        DB.get('settings','id=eq.1&select=tickets_sold,free_used,booking_enabled,free_enabled,free_tickets,total_tickets,auto_approval,free_code,event_date_iso'),
        DB.get('tickets','status=eq.approved&select=id')
      ]);
      if(rows&&rows[0]){
        const prev=JSON.stringify({a:S.cfg.tickets_sold,b:S.cfg.free_used,c:S.cfg.booking_enabled,d:S.cfg.free_code});
        Object.assign(S.cfg,rows[0]);S.cfg._approvedCount=appr.length;
        const next=JSON.stringify({a:S.cfg.tickets_sold,b:S.cfg.free_used,c:S.cfg.booking_enabled,d:S.cfg.free_code});
        if(prev!==next)applySettings();
      }
      setSync('live');
      if(!S.tickets.length)return;
      const ids=S.tickets.map(t=>t.id);
      const fresh=await DB.get('tickets',`id=in.(${ids.join(',')})&select=id,status`);
      fresh.forEach(row=>{
        const prev=S.knownSt[row.id];
        if(prev&&prev!==row.status){
          const tk=S.tickets.find(t=>t.id===row.id);
          pushNotif(`ğŸ« ${tk?.ticket_id||'Ticket'} â†’ ${row.status.toUpperCase()}`);
          if(row.status==='approved')launchConfetti();
          const idx=S.tickets.findIndex(t=>t.id===row.id);
          if(idx>=0)S.tickets[idx].status=row.status;
          if(S.booking?.id===row.id){S.booking.status=row.status;setBadge('tktStatusBadge',row.status);}
          if(_el('view-tickets').classList.contains('active'))renderTcards();
        }
        S.knownSt[row.id]=row.status;
      });
    }catch(e){setSync('fail');}
    finally{S.pollRunning=false;}
  },10000);
}
function setSync(state){
  const chip=_el('syncChip'),dot=chip?.querySelector('.sync-dot'),lbl=_el('syncLbl');
  if(!chip)return;
  if(state==='live'){
    _sf.n=0;chip.className='sync-chip live';lbl.textContent='Live';
  }else if(state==='connecting'){
    chip.className='sync-chip connecting';lbl.textContent='Connecting';
  }else{
    _sf.n++;
    if(_sf.n>=2){chip.className='sync-chip offline';lbl.textContent='Offline';}
  }
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  VIEWS + WIZARD
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function gotoView(name,btn){
  $$('.view').forEach(v=>v.classList.remove('active'));
  _el(`view-${name}`).classList.add('active');
  $$('.nav-pill').forEach(b=>b.classList.remove('active'));
  if(btn)btn.classList.add('active');
  else document.querySelector(`[data-v="${name}"]`)?.classList.add('active');
  if(name==='tickets')loadMyTickets();
}
function goStep(n){
  if(n<1)n=1;
  if(n>S.step&&n!==S.step+1)return;
  if(n===3&&S.step===2&&!validateStep2())return;
  $$('.step-pane').forEach(p=>p.classList.remove('active'));
  _el(`step${n}`).classList.add('active');
  for(let i=1;i<=4;i++){
    const ws=_el(`ws${i}`);ws.classList.remove('active','done');
    if(i<n)ws.classList.add('done');else if(i===n)ws.classList.add('active');
  }
  S.step=n;
  if(n===3)setupPayStep();
  window.scrollTo({top:0,behavior:'smooth'});
}
function setupPayStep(){
  const total=calcTotal(),isFree=total===0;
  _show('freePaySection',isFree);
  _show('paidPaySection',!isFree);
  if(!isFree){
    const ua=_el('upiAmt');if(ua){ua.textContent='â‚¹'+total;ua.className='pay-amount';}
    const psa=_el('payStepAmt');if(psa)psa.textContent='â‚¹'+total;
    const uid=_el('upiIdTxt');if(uid)uid.textContent=S.cfg.upi_id||'';
    _el('upiQrDiv').innerHTML='';
    try{new QRCode(_el('upiQrDiv'),{text:`upi://pay?pa=${encodeURIComponent(S.cfg.upi_id||'')}&pn=Reel+to+Deal&am=${total}&cu=INR`,width:90,height:90,colorDark:'#d4a843',colorLight:'#ffffff'});}catch(e){}
  }
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  PRICE CALCULATIONS â€” ALL gated on S.freeUnlocked
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function getFreeLeft(){
  const c=S.cfg;
  // Free seats only count if: feature enabled AND user unlocked AND slots remain
  if(c.free_enabled===false||!S.freeUnlocked)return 0;
  return Math.max(0,(c.free_tickets||0)-(c.free_used||0));
}
function calcTotal(){
  const fl=getFreeLeft();
  return(S.qty-Math.min(S.qty,fl))*(S.cfg.ticket_price||100);
}
function updatePriceSummary(){
  const c=S.cfg,fl=getFreeLeft();
  const applied=Math.min(S.qty,fl),total=(S.qty-applied)*(c.ticket_price||100),isFree=total===0;
  _t('priceQty',S.qty);
  const pp=_el('pricePer');
  if(pp){pp.textContent=isFree?'FREE âœ¨':'â‚¹'+(c.ticket_price||100);pp.style.color=isFree?'var(--green)':'';}
  _show('freeRow',applied>0);
  if(applied>0)_t('freeSeats',`${applied} seat${applied>1?'s':''} free`);
  const pt=_el('priceTotal');
  if(pt){pt.textContent=isFree?'â‚¹0 â€” FREE! âœ¨':'â‚¹'+total;pt.className='pr-v'+(isFree?' free':'');}
}
function chgQty(d){
  const max=Math.min(S.cfg.max_per_user||5,Math.max(1,(S.cfg.total_tickets||200)-(S.cfg.tickets_sold||0)),10);
  S.qty=Math.max(1,Math.min(max,S.qty+d));
  _t('qtyNum',S.qty);
  _el('qtyMinus').disabled=S.qty<=1;
  _el('qtyPlus').disabled=S.qty>=max;
  updatePriceSummary();
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  FREE TICKET ACCESS CODE GATE
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function resetFg(){
  const msg=_el('fgMsg'),inp=_el('fgCode');
  if(msg){msg.className='fg-msg';msg.textContent='';}
  if(inp){inp.classList.remove('ok','bad');}
}
async function verifyCode(){
  const inp=_el('fgCode'),msg=_el('fgMsg');
  const code=(inp?.value||'').trim().toUpperCase();
  try{
    const rows=await DB.get('settings','id=eq.1&select=free_code');
    const valid=(rows[0]?.free_code||'').trim().toUpperCase();
    if(!valid||code===valid){
      // No code set (open) OR correct code entered
      S.freeUnlocked=true;
      if(inp){inp.classList.add('ok');}
      if(msg){msg.className='fg-msg ok';msg.textContent='âœ“ '+(valid?'Code accepted â€” free ticket unlocked!':'Free ticket claimed!');}
      toast('Free ticket unlocked! âœ¨','ok');
      applySettings();  // re-renders price card and price summary
    }else{
      S.freeUnlocked=false;
      if(!code){msg.className='fg-msg err';msg.textContent='Please enter your access code.';return;}
      if(inp){inp.classList.add('bad');setTimeout(()=>inp.classList.remove('bad'),400);}
      if(msg){msg.className='fg-msg err';msg.textContent='âœ• Invalid code â€” please try again.';}
    }
  }catch(e){
    if(msg){msg.className='fg-msg err';msg.textContent='Connection error â€” try again.';}
  }
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  VALIDATE
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function san(s){return String(s||'').replace(/[<>'";&\\]/g,'').trim().slice(0,256);}
function vf(id){
  const el=_el(id);if(!el)return true;
  const v=el.value.trim();let ok=true;
  if(id==='inName')  ok=v.length>=2&&v.length<=100;
  if(id==='inEmail') ok=/^[^\s@]{1,64}@[^\s@]{1,64}\.[^\s@]{1,24}$/.test(v);
  if(id==='inPhone') ok=/^[6-9]\d{9}$/.test(v);
  if(id==='inUTR')   ok=v.length>=6||(calcTotal()===0&&v.length===0);
  el.classList.toggle('err',!ok&&v.length>0);
  const em={inName:'eN',inEmail:'eE',inPhone:'eP',inUTR:'eU'};
  if(em[id]){const e=_el(em[id]);if(e)e.classList.toggle('show',!ok&&v.length>0);}
  return ok;
}
function validateStep2(){
  const ok=['inName','inEmail','inPhone'].map(f=>vf(f)).every(Boolean);
  if(!ok)toast('Please fill all required fields correctly','err');
  return ok;
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  PAYMENT HELPERS
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function copyUPI(){navigator.clipboard.writeText(S.cfg.upi_id||'').then(()=>toast('UPI ID copied ğŸ“‹','ok'));}
function openUPI(){window.location.href=`upi://pay?pa=${encodeURIComponent(S.cfg.upi_id||'')}&pn=Reel+to+Deal&am=${calcTotal()}&cu=INR`;}

async function compressImage(file,maxDim=1200,q=0.82){
  return new Promise(res=>{
    const img=new Image(),url=URL.createObjectURL(file);
    img.onload=()=>{
      URL.revokeObjectURL(url);
      const s=Math.min(1,maxDim/Math.max(img.width,img.height));
      const w=Math.round(img.width*s),h=Math.round(img.height*s);
      const cv=document.createElement('canvas');cv.width=w;cv.height=h;
      cv.getContext('2d').drawImage(img,0,0,w,h);
      cv.toBlob(b=>res(b?new File([b],file.name,{type:'image/jpeg'}):file),'image/jpeg',q);
    };
    img.onerror=()=>{URL.revokeObjectURL(url);res(file);};
    img.src=url;
  });
}
function onFileSelect(e){
  const f=e.target.files[0];if(!f)return;
  if(!['image/jpeg','image/png','image/webp'].includes(f.type)){toast('Invalid file â€” use JPG, PNG or WEBP','err');e.target.value='';return;}
  if(f.size>5*1024*1024){toast('File too large â€” max 5MB','err');e.target.value='';return;}
  const reader=new FileReader();
  reader.onload=ev=>{
    const img=_el('previewImg');
    img.src=ev.target.result;
    img.style.cssText='display:block;width:100%;max-height:180px;object-fit:contain;border-radius:8px;margin-top:10px;';
  };
  reader.readAsDataURL(f);
  compressImage(f).then(c=>{S.ssFileObj=c;_el('uploadOk').classList.add('show');_el('uploadZone').classList.add('drag');toast('Screenshot ready âœ“','ok');});
}
document.addEventListener('DOMContentLoaded',()=>{
  const zone=_el('uploadZone');if(!zone)return;
  zone.addEventListener('dragover',e=>{e.preventDefault();zone.classList.add('drag');});
  zone.addEventListener('dragleave',()=>zone.classList.remove('drag'));
  zone.addEventListener('drop',e=>{
    e.preventDefault();zone.classList.remove('drag');
    const f=e.dataTransfer.files[0];if(!f)return;
    const input=_el('ssFile');
    try{const dt=new DataTransfer();dt.items.add(f);input.files=dt.files;}catch{}
    onFileSelect({target:{files:[f],value:''}});
  });
},{once:true});

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  SUBMIT BOOKING
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
async function submitBooking(){
  if(S.submitting){toast('Already processingâ€¦','warn');return;}
  const total=calcTotal(),isFree=total===0,utrVal=san((_el('inUTR')||{}).value||'');
  if(!isFree){
    if(!vf('inUTR')){toast('Please enter your UTR / Transaction ID','err');return;}
    if(!S.ssFileObj){toast('Please upload your payment screenshot','warn');return;}
  }
  S.submitting=true;
  const btn=_el('submitBtn'),btxt=_el('submitTxt');
  btn.disabled=true;btxt.innerHTML='<span class="spin"></span> Processingâ€¦';
  showLoading('Submitting your bookingâ€¦');
  try{
    const rows=await DB.get('settings','id=eq.1&select=*');
    const fresh=rows[0]||S.cfg;
    if(!fresh.booking_enabled){toast('Bookings are currently paused','err');return;}
    const rem=(fresh.total_tickets||200)-(fresh.tickets_sold||0);
    if(rem<S.qty){toast('Not enough seats remaining!','err');return;}
    // Re-check free slots with freeUnlocked guard
    const freeLeft=(fresh.free_enabled!==false&&S.freeUnlocked)?Math.max(0,(fresh.free_tickets||0)-(fresh.free_used||0)):0;
    const freeApplied=Math.min(S.qty,freeLeft),finalAmt=(S.qty-freeApplied)*(fresh.ticket_price||100),thisIsFree=finalAmt===0;
    const tid='RTD-'+Date.now().toString(36).toUpperCase()+'-'+Math.random().toString(36).substr(2,4).toUpperCase();
    const name=san((_el('inName')||{}).value||'');
    const email=san((_el('inEmail')||{}).value||'');
    const phone=san((_el('inPhone')||{}).value||'');
    const college=san((_el('inCollege')||{}).value||'');
    const roll=_el('inRoll')?san(_el('inRoll').value):null;
    const dept=_el('inDept')?san(_el('inDept').value):null;
    const yr=_el('inYear')?san(_el('inYear').value):null;
    const sect=_el('inSect')?san(_el('inSect').value):null;
    if(!thisIsFree&&utrVal){
      const dup=await DB.get('tickets',`utr=eq.${encodeURIComponent(utrVal)}&select=id`);
      if(dup.length){toast('This UTR is already registered!','err');return;}
    }
    const qrData=`RTD|${tid}|${name}|${email}|${thisIsFree?'FREE':finalAmt}`;
    let ssURL='';
    if(!thisIsFree&&S.ssFileObj){
      try{ssURL=await DB.upload('screenshots',`${tid}.jpg`,S.ssFileObj);}
      catch(e){console.warn('Upload failed:',e);toast('Screenshot upload failed â€” continuing','warn');}
    }
    const autoApprove=fresh.auto_approval||false,initStatus=autoApprove?'approved':'pending';
    const result=await DB.post('tickets',{
      ticket_id:tid,user_name:name,email,phone,college,
      roll_no:roll,department:dept,year_of_study:yr,section:sect,
      movie_name:fresh.event_name||S.cfg.event_name,quantity:S.qty,
      amount:finalAmt,is_free:thisIsFree,utr:utrVal||null,
      screenshot_url:ssURL||null,qr_data:qrData,status:initStatus,
      payment_status:thisIsFree?'free':(utrVal?'submitted':'pending'),
      event_date:fresh.event_date||S.cfg.event_date,venue:fresh.venue||S.cfg.venue
    });
    const ticket=Array.isArray(result)?result[0]:result;
    await DB.patch('settings','id=eq.1',{
      tickets_sold:(fresh.tickets_sold||0)+S.qty,
      free_used:(fresh.free_used||0)+freeApplied
    });
    S.cfg.tickets_sold=(fresh.tickets_sold||0)+S.qty;
    S.cfg.free_used=(fresh.free_used||0)+freeApplied;
    S.booking=ticket;S.knownSt[ticket.id]=initStatus;S.tickets.unshift(ticket);
    renderTicket(ticket,thisIsFree);
    goStep(4);applySettings();
    if(autoApprove)launchConfetti();
    toast('ğŸ‰ Booking submitted!','ok');
    pushNotif(`ğŸ« ${tid} â€” ${autoApprove?'auto-approved!':'awaiting verification'}`);
  }catch(e){
    console.error('Booking error:',e);
    toast('Booking failed â€” check connection and retry','err');
  }finally{
    S.submitting=false;btn.disabled=false;btxt.textContent='Submit Booking';hideLoading();
  }
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  RENDER TICKET
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function renderTicket(t,isFree){
  const mv=(t.movie_name||'').length>30?(t.movie_name||'').slice(0,27)+'â€¦':(t.movie_name||'â€”');
  _t('tktBrand',`ğŸ¬ ${t.movie_name||'Reel to Deal'} Â· MBA Fest 2025`);
  _t('tktMovie',mv);
  _t('tktDate', t.event_date||S.cfg.event_date);
  _t('tktVenue',t.venue||S.cfg.venue);
  _t('tktQty',  (t.quantity||1)+' Seat(s)');
  _t('tktName', t.user_name);
  _t('tktEmail',t.email);
  _el('tktAmt').textContent=isFree?'FREE âœ¨':'â‚¹'+t.amount;
  _el('tktAmt').className='t-dv '+(isFree?'green':'gold');
  _el('tktType').innerHTML=isFree
    ?'<span class="sbadge sb-free"><div class="sd"></div>Free Ticket</span>'
    :'<span style="color:var(--gold2);font-family:JetBrains Mono,monospace;font-size:0.62rem">Paid</span>';
  _t('tktTid',t.ticket_id);
  setBadge('tktStatusBadge',t.status||'pending');
  _el('tktFreeStamp').style.display=isFree?'block':'none';
  _el('s4sub').textContent=isFree?'Free ticket claimed â€” pending seat assignment':'Payment under review by admin';
  const qrEl=_el('qrDiv');qrEl.innerHTML='';
  try{
    const qrText=t.qr_data||`RTD|${t.ticket_id}|${t.user_name}|${isFree?'FREE':t.amount}`;
    new QRCode(qrEl,{text:qrText,width:88,height:88,colorDark:'#d4a843',colorLight:'#ffffff'});
  }catch(e){}
}
function setBadge(id,status){
  const el=_el(id);if(!el)return;
  const m={pending:['sb-pending','â³ Pending'],review:['sb-review','ğŸ” Review'],approved:['sb-approved','âœ… Approved'],rejected:['sb-rejected','âŒ Rejected']};
  const[cls,lbl]=m[status]||m.pending;
  el.className='sbadge '+cls;el.innerHTML=`<div class="sd"></div>${lbl}`;
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  MY TICKETS
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
async function loadMyTickets(){
  _show('skelCards',true);_el('tcardList').style.display='none';
  try{
    S.tickets=await DB.get('tickets','order=created_at.desc&select=*&limit=200');
    S.tickets.forEach(t=>{S.knownSt[t.id]=t.status;});
    setSync('live');
  }catch(e){setSync('fail');toast('Could not load tickets','err');}
  renderTcards();
  _show('skelCards',false);_el('tcardList').style.display='block';
}
function filterTix(f,btn){
  S.tixFilter=f;$$('.tab-btn').forEach(b=>b.classList.remove('active'));btn.classList.add('active');renderTcards();
}
function renderTcards(){
  const el=_el('tcardList');
  let list=S.tickets;
  if(S.tixFilter!=='all')list=list.filter(t=>t.status===S.tixFilter);
  if(!list.length){
    el.innerHTML=`<div class="empty-state"><div class="empty-ico">ğŸŸ</div><div class="empty-ttl">${S.tixFilter==='all'?'No tickets yet':'No '+S.tixFilter+' tickets'}</div><div class="empty-sub">${S.tixFilter==='all'?'Book your first seat above':'Change filter to see other tickets'}</div></div>`;
    return;
  }
  el.innerHTML=list.map(t=>{
    const isFree=t.is_free,st=t.status||'pending';
    const stripCls=isFree?'ts-free':('ts-'+st);
    return`<div class="tcard">
      <div class="tcard-strip ${stripCls}"></div>
      <div class="tcard-head">
        <div><div class="tc-movie">${esc(t.movie_name||'Reel to Deal')}</div><div class="tc-id">${esc(t.ticket_id)}</div></div>
        <div id="tsBadge-${t.id}" class="sbadge sb-${st}"><div class="sd"></div>${st.charAt(0).toUpperCase()+st.slice(1)}</div>
      </div>
      <div class="tcard-body">
        <div class="tc-col"><div class="tc-col-lbl">Seats</div><div class="tc-col-val">${t.quantity||1}</div></div>
        <div class="tc-col"><div class="tc-col-lbl">Amount</div><div class="tc-col-val ${isFree?'green':''}">${isFree?'FREE âœ¨':'â‚¹'+(t.amount||0)}</div></div>
        <div class="tc-col"><div class="tc-col-lbl">Date</div><div class="tc-col-val">${esc(t.event_date||'â€”')}</div></div>
        <div class="tc-col"><div class="tc-col-lbl">Venue</div><div class="tc-col-val">${esc((t.venue||'â€”').slice(0,18))}</div></div>
      </div>
      <div class="tcard-foot">
        <button class="btn btn-ghost" style="font-size:0.52rem;min-height:32px;padding:0 10px" onclick="viewTicket('${t.id}')">View Ticket â†’</button>
        <button class="share-btn" onclick="dlTixPDF('${t.id}')">â¬‡ PDF</button>
      </div>
    </div>`;
  }).join('');
}
function viewTicket(id){
  const t=S.tickets.find(x=>x.id===id);if(!t)return;
  S.booking=t;renderTicket(t,t.is_free);goStep(4);gotoView('book',document.querySelector('[data-v="book"]'));
}
function exportMyCSV(){
  if(!S.tickets.length){toast('No tickets to export','warn');return;}
  const hdr=['ticket_id','user_name','email','phone','college','quantity','amount','is_free','status','event_date','venue','created_at'];
  const rows=S.tickets.map(t=>hdr.map(k=>JSON.stringify(t[k]??'')).join(','));
  const blob=new Blob([hdr.join(',')+'\n'+rows.join('\n')],{type:'text/csv'});
  const a=document.createElement('a');a.href=URL.createObjectURL(blob);a.download='my-tickets.csv';a.click();
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  PDF
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function dlPDF(){if(S.booking)genPDF(S.booking);else toast('No ticket to download','err');}
function dlTixPDF(id){const t=S.tickets.find(t=>t.id===id);if(t)genPDF(t);}
function genPDF(t){
  try{
    const{jsPDF}=window.jspdf;
    const doc=new jsPDF({orientation:'landscape',unit:'pt',format:[255,165]});
    const isFree=t.is_free;
    doc.setFillColor(14,11,5);doc.rect(0,0,255,165,'F');
    doc.setFillColor(212,168,67);doc.rect(0,0,255,26,'F');
    doc.setTextColor(14,11,5);doc.setFont('helvetica','bold');doc.setFontSize(8);
    doc.text(((t.movie_name||'REEL TO DEAL').toUpperCase()+' Â· MBA FEST 2025').slice(0,55),127.5,17,{align:'center'});
    if(isFree){doc.setFillColor(61,214,140);doc.rect(193,0,62,26,'F');doc.setTextColor(14,11,5);doc.setFontSize(6);doc.text('FREE TICKET',224,15,{align:'center'});}
    doc.setTextColor(240,234,216);doc.setFont('helvetica','bold');doc.setFontSize(13);
    doc.text((t.movie_name||'Reel to Deal').slice(0,30),14,45);
    doc.setFont('helvetica','normal');doc.setFontSize(7.5);doc.setTextColor(138,126,106);
    doc.text(`${(t.event_date||'').slice(0,30)} Â· ${(t.venue||'').slice(0,20)}`,14,58);
    const fields=[['Ticket ID',t.ticket_id],['Name',t.user_name],['Email',t.email],['Phone',t.phone||'â€”'],['Seats',String(t.quantity)],['Amount',isFree?'FREE âœ¨':'â‚¹'+t.amount],['Status',(t.status||'pending').toUpperCase()]];
    let y=74;
    fields.forEach(([k,v])=>{
      doc.setTextColor(138,126,106);doc.setFontSize(6.5);doc.text(k+':',14,y);
      doc.setTextColor(isFree&&k==='Amount'?[61,214,140]:[240,234,216]);doc.setFontSize(7.5);doc.text(String(v).slice(0,38),72,y);y+=13;
    });
    doc.setFillColor(30,22,8);doc.rect(0,148,255,17,'F');
    doc.setTextColor(212,168,67);doc.setFontSize(6);
    doc.text('Valid only with admin approval Â· Reel to Deal MBA Fest 2025',127.5,158,{align:'center'});
    doc.save(`RTD-${t.ticket_id}.pdf`);toast('PDF downloaded âœ“','ok');
  }catch(e){console.error(e);toast('PDF failed','err');}
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  BOOK ANOTHER
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function bookAnother(){
  S.qty=1;S.booking=null;S.ssFileObj=null;S.submitting=false;S.step=1;
  ['inName','inEmail','inPhone','inCollege','inUTR','inRoll','inDept','inSect'].forEach(id=>{const e=_el(id);if(e)e.value='';});
  const yr=_el('inYear');if(yr)yr.value='';
  _el('ssFile').value='';
  const pi=_el('previewImg');if(pi){pi.src='';pi.style.cssText='display:none';}
  _el('uploadOk').classList.remove('show');
  _el('uploadZone').classList.remove('drag');
  _t('qtyNum','1');
  $$('.ferr.show').forEach(e=>e.classList.remove('show'));
  $$('.fi.err').forEach(e=>e.classList.remove('err'));
  goStep(1);
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  SHARE + COPY
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function shareTicket(){
  if(!S.booking)return;
  const t=S.booking;
  const text=`ğŸ¬ ${t.movie_name||'Reel to Deal'} Â· MBA Fest 2025\nTicket: ${t.ticket_id}\nName: ${t.user_name}\nSeats: ${t.quantity}\nAmount: ${t.is_free?'FREE':'â‚¹'+t.amount}`;
  if(navigator.share){navigator.share({title:'Reel to Deal Ticket',text}).catch(()=>{});}
  else{navigator.clipboard.writeText(text).then(()=>toast('Ticket details copied','ok'));}
}
function copyTicketId(){
  if(!S.booking){toast('No ticket loaded','warn');return;}
  navigator.clipboard.writeText(S.booking.ticket_id||'').then(()=>toast('Ticket ID copied ğŸ“‹','ok'));
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  CONFETTI
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function launchConfetti(){
  const colors=['#d4a843','#f0c760','#fbe49a','#3dd68c','#60a5fa','#f05252','#a78bfa'];
  for(let i=0;i<60;i++)setTimeout(()=>{
    const el=document.createElement('div');el.className='confetti-piece';
    el.style.cssText=`left:${Math.random()*100}vw;background:${colors[Math.floor(Math.random()*colors.length)]};animation-duration:${0.8+Math.random()*1.4}s;`;
    document.body.appendChild(el);setTimeout(()=>el.remove(),2400);
  },i*25);
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  NOTIFICATIONS + TOAST
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function pushNotif(msg){
  S.notifs.unshift({msg,t:new Date()});
  if(S.notifs.length>30)S.notifs.pop();
  const b=_el('bellBadge');b.textContent=S.notifs.length;b.style.display='flex';
  renderNotifs();
}
function toggleNotif(){_el('notifPanel').classList.toggle('open');}
function clearNotifs(){S.notifs=[];renderNotifs();_el('bellBadge').style.display='none';_el('notifPanel').classList.remove('open');}
function renderNotifs(){
  _el('notifList').innerHTML=S.notifs.length
    ?S.notifs.map(n=>`<div class="notif-item"><div>${esc(n.msg)}</div><div class="ni-time">${n.t.toLocaleTimeString()}</div></div>`).join('')
    :'<div class="notif-empty">No notifications</div>';
}
const _tk=new Map();
function toast(msg,type=''){
  const key=type+'|'+msg;if(_tk.has(key))return;
  _tk.set(key,true);setTimeout(()=>_tk.delete(key),900);
  const el=document.createElement('div');
  el.className='toast'+(type?' '+type:'');
  el.textContent=({ok:'âœ“ ',err:'âœ• ',warn:'âš  '}[type]||'')+msg;
  _el('toastWrap').appendChild(el);
  setTimeout(()=>{el.classList.add('bye');setTimeout(()=>el.remove(),230);},3400);
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  LOADING OVERLAY
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function showLoading(txt='Loadingâ€¦'){_t('loadingTxt',txt);_el('loadingOv').classList.add('show');}
function hideLoading(){_el('loadingOv').classList.remove('show');}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  UTILS
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function animNum(id,n){
  const el=_el(id);if(!el)return;
  if(el.textContent===String(n))return;
  el.textContent=n;el.classList.add('flash');setTimeout(()=>el.classList.remove('flash'),600);
}
function esc(s){return String(s||'').replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;').replace(/"/g,'&quot;');}
const _el=id=>document.getElementById(id);
const _t=(id,v)=>{const e=_el(id);if(e)e.textContent=v;};
const _show=(id,v)=>{const e=_el(id);if(e)e.style.display=v?'':'none';};
const $$=s=>document.querySelectorAll(s);

// Outside-click: close notif
document.addEventListener('click',e=>{
  const p=_el('notifPanel');
  if(p&&!p.contains(e.target)&&!_el('bellBtn')?.contains(e.target))p.classList.remove('open');
});
document.addEventListener('touchmove',e=>{if(_el('loadingOv')?.classList.contains('show'))e.preventDefault();},{passive:false});
document.addEventListener('keydown',e=>{if(e.key==='Escape')_el('notifPanel')?.classList.remove('open');});
</script>
</body>
</html>
